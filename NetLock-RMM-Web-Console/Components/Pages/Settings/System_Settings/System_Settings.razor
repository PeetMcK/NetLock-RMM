@page "/system"

@using MySqlConnector;
@using System.Data.Common;
@using System.Text.Json;
@using System.Xml.Serialization;
@using System.Text;
@using Microsoft.AspNetCore.Components.Server.ProtectedBrowserStorage;
@using Microsoft.AspNetCore.DataProtection;
@using System.Net.Http;
@using System.Net.Http.Headers;
@using System.Net;
@using System.Security.Claims
@using NetLock_RMM_Web_Console.Classes.Authentication

@inject NavigationManager NavigationManager
@inject ILocalStorageService localStorage
@inject IDialogService DialogService
@inject ISnackbar Snackbar
@inject IJSRuntime JSRuntime
@inject IDataProtectionProvider DataProtectionProvider
@inject IStringLocalizer<Pages.Settings.System_Settings.System_Settings> Localizer
@inject AuthenticationStateProvider AuthenticationStateProvider

<style>
    .selected-row-light {
    background-color: lightgray;
    }

    .selected-row-dark {
    background-color: #141414;
    }

    .custom-expansion-panel {
    background-color: transparent;
    }

    .dialog-blurring {
    backdrop-filter: blur(10px);
    }

    .mud-table-cell-custom-group {
    font-weight: 500;
    }

    .mud-table-cell-custom-group-footer {
    padding-bottom: 50px;
    text-align: right;
    }

    @@media only screen and (max-width: 768px) {
    .desktop-icon {
    display: none;
    }
    }

    @@keyframes fadeIn {
    from {opacity: 0;}
    to {opacity: 1;}
    }

    .animated-text {
    animation: pulse 2s infinite ease-in-out;
    }

    @@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.6; }
    }

    .wave-emoji {
    display: inline-block;
    animation: wave 2s infinite;
    transform-origin: 70% 70%;
    }

    @@keyframes wave {
    0% { transform: rotate(0deg); }
    15% { transform: rotate(15deg); }
    30% { transform: rotate(-10deg); }
    45% { transform: rotate(15deg); }
    60% { transform: rotate(-10deg); }
    75% { transform: rotate(15deg); }
    100% { transform: rotate(0deg); }
    }

</style>

<MudOverlay Visible="@loading_overlay" DarkBackground="false" Absolute="false">
    <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; gap: 1rem; animation: fadeIn 0.5s ease-in-out;">
        <MudProgressCircular Color="Color.Primary" Size="Size.Large" Indeterminate="true" Thickness="6" />
        <MudText Typo="Typo.h5" Class="animated-text">
            Please wait... <span class="wave-emoji">üêß</span>
        </MudText>
    </div>
</MudOverlay>

<AuthorizeView>

    <Authorized>

        @if (Configuration.Members_Portal.IsCloudEnabled)
        {
            <MudAlert Class="mb-3" Severity="Severity.Warning">This section is administered by the cloud team. The view is limited. :-)</MudAlert>
        }

        @if (permissions_settings_enabled && permissions_settings_system_enabled)
        {
            <MudTabs KeepPanelsAlive=true Class="mt-0" Elevation="4" Rounded="false" Color="@Color.Default">

                @if (!Configuration.Members_Portal.IsCloudEnabled)
                {
                <MudTabPanel Text="Overview">

                        <MudPaper Elevation="4" Class="mt-0">

                            <MudText Class="ml-2" Typo="Typo.h6">@Localizer["MySQL"]</MudText>

                            <MudGrid>
                                <!-- MySQL Connection Status -->
                                <MudItem xs="12" sm="4">
                                    <MudCard Class="pa-2" Elevation="2">
                                        <MudCardContent>
                                            @if (mysqlConnectionStatus)
                                            {
                                                <div style="display: flex; align-items: center;">
                                                    <MudIcon Icon="@Icons.Material.Filled.CheckCircle" Color="Color.Success" />
                                                    <MudText Class="ml-2" Color="Color.Success">@Localizer["connected"]</MudText>
                                                </div>

                                                <!-- Additional MySQL Info -->
                                                <MudText Typo="Typo.body2">Version: @mysqlVersion</MudText>
                                                <MudText Typo="Typo.body2">@Localizer["uptime"]: @mysqlUptime (seconds)</MudText>
                                                <MudText Typo="Typo.body2">@Localizer["active connections"]: @mysqlConnectedUsers</MudText>
                                                <MudText Typo="Typo.body2">@Localizer["database size"]: @mysqlDatabaseSize</MudText>

                                                <!-- Security Info -->
                                                <MudText Typo="Typo.body2">@Localizer["max connections"]: @mysqlMaxConnections</MudText>
                                                <MudText Typo="Typo.body2">@Localizer["failed logins"]: @mysqlFailedLogins</MudText>
                                            }
                                            else
                                            {
                                                <div style="display: flex; align-items: center;">
                                                    <MudIcon Icon="@Icons.Material.Filled.Error" Color="Color.Error" />
                                                    <MudText Class="ml-2" Color="Color.Error">@Localizer["not connected"]</MudText>
                                                </div>
                                            }
                                        </MudCardContent>
                                    </MudCard>
                                </MudItem>
                            </MudGrid>

                            <MudText Class="mt-3 ml-2" Typo="Typo.h6">@Localizer["active queries"]</MudText>

                            <MudTable Height="25vh" FixedHeader="true" FixedFooter="true" Hover="true" RowsPerPage="int.MaxValue" Dense="true" Items="@mysqlActiveQueries" Filter="new Func<MySQL_Active_Queries, bool>(MySQL_Active_Queries_Table_Filter_Func)">
                                <ToolBarContent>
                                    <MudTextField Class="mt-0" @bind-Value="mysql_active_queries_table_search_string" Placeholder="@Localizer["search"]" Adornment="Adornment.Start" AdornmentIcon="@Icons.Material.Filled.Search" IconSize="Size.Medium"></MudTextField>
                                </ToolBarContent>
                                <HeaderContent>
                                    <MudTh @onclick="() => mysql_active_queries_table_sorted_column = (nameof(MySQL_Active_Queries.Id))" style="white-space: nowrap;">Id</MudTh>
                                    <MudTh @onclick="() => mysql_active_queries_table_sorted_column = (nameof(MySQL_Active_Queries.User))" style="white-space: nowrap;">User</MudTh>
                                    <MudTh @onclick="() => mysql_active_queries_table_sorted_column = (nameof(MySQL_Active_Queries.Host))" style="white-space: nowrap;">Host</MudTh>
                                    <MudTh @onclick="() => mysql_active_queries_table_sorted_column = (nameof(MySQL_Active_Queries.Database))" style="white-space: nowrap;">Database</MudTh>
                                    <MudTh @onclick="() => mysql_active_queries_table_sorted_column = (nameof(MySQL_Active_Queries.Command))" style="white-space: nowrap;">Command</MudTh>
                                    <MudTh @onclick="() => mysql_active_queries_table_sorted_column = (nameof(MySQL_Active_Queries.Time))" style="white-space: nowrap;">Time</MudTh>
                                    <MudTh @onclick="() => mysql_active_queries_table_sorted_column = (nameof(MySQL_Active_Queries.State))" style="white-space: nowrap;">State</MudTh>
                                    <MudTh @onclick="() => mysql_active_queries_table_sorted_column = (nameof(MySQL_Active_Queries.Info))" style="white-space: nowrap;">Info</MudTh>
                                </HeaderContent>

                                <RowTemplate Context="row">

                                    <MudTd DataLabel="Id" @onclick="() => mysql_active_queries_RowClickHandler(row)" class="@mysql_active_queries_GetRowClass(row)" style="white-space: nowrap;">
                                        <span style="display: flex; align-items: center;">
                                            &nbsp;@row.Id
                                        </span>
                                    </MudTd>

                                    <MudTd DataLabel="User" @onclick="() => mysql_active_queries_RowClickHandler(row)" class="@mysql_active_queries_GetRowClass(row)" style="white-space: nowrap;">
                                        <span style="display: flex; align-items: center;">
                                            &nbsp;@row.User
                                        </span>
                                    </MudTd>

                                    <MudTd DataLabel="Host" @onclick="() => mysql_active_queries_RowClickHandler(row)" class="@mysql_active_queries_GetRowClass(row)" style="white-space: nowrap;">
                                        <span style="display: flex; align-items: center;">
                                            &nbsp;@row.Host
                                        </span>
                                    </MudTd>

                                    <MudTd DataLabel="Database" @onclick="() => mysql_active_queries_RowClickHandler(row)" class="@mysql_active_queries_GetRowClass(row)" style="white-space: nowrap;">
                                        <span style="display: flex; align-items: center;">
                                            &nbsp;@row.Database
                                        </span>
                                    </MudTd>

                                    <MudTd DataLabel="Command" @onclick="() => mysql_active_queries_RowClickHandler(row)" class="@mysql_active_queries_GetRowClass(row)" style="white-space: nowrap;">
                                        <span style="display: flex; align-items: center; color: @(GetCommandColor(row.Command, row.Time))">
                                            &nbsp;@row.Command
                                        </span>
                                    </MudTd>

                                    <MudTd DataLabel="Time" @onclick="() => mysql_active_queries_RowClickHandler(row)" class="@mysql_active_queries_GetRowClass(row)" style="white-space: nowrap;">
                                        <span style="display: flex; align-items: center;">
                                            &nbsp;@row.Time
                                        </span>
                                    </MudTd>

                                    <MudTd DataLabel="State" @onclick="() => mysql_active_queries_RowClickHandler(row)" class="@mysql_active_queries_GetRowClass(row)" style="white-space: nowrap;">
                                        <span style="display: flex; align-items: center;">
                                            &nbsp;@row.State
                                        </span>
                                    </MudTd>

                                    <MudTd DataLabel="Info" @onclick="() => mysql_active_queries_RowClickHandler(row)" class="@mysql_active_queries_GetRowClass(row)" style="white-space: nowrap;">
                                        <span style="display: flex; align-items: center;">
                                            &nbsp;@row.Info
                                        </span>
                                    </MudTd>

                                </RowTemplate>
                                <PagerContent>
                                    <MudTablePager PageSizeOptions="new int[] { 10, 25, 50, 100, 250, 500, int.MaxValue }" RowsPerPageString="@Localizer["entries per page"]" />
                                </PagerContent>
                            </MudTable>

                        </MudPaper>

                        <MudPaper Class="mt-3">
                            <MudText Class="ml-2" Typo="Typo.h6">@Localizer["Web Console"]</MudText>

                            <MudGrid>
                                <!-- CPU Usage -->
                                <MudItem xs="12" sm="4">
                                    <MudCard Class="pa-2" Elevation="2">
                                        <MudCardContent>
                                            <MudText Typo="Typo.subtitle1">@Localizer["cpu usage"]: @cpuUsage%</MudText>
                                            <MudProgressLinear Value="@cpuUsage" Color="Color.Primary" />
                                        </MudCardContent>
                                    </MudCard>
                                </MudItem>

                                <!-- RAM Usage -->
                                <MudItem xs="12" sm="4">
                                    <MudCard Class="pa-2" Elevation="2">
                                        <MudCardContent>
                                            <MudText Typo="Typo.subtitle1">@Localizer["ram usage"]: @ramUsage%</MudText>
                                            <MudProgressLinear Value="@ramUsage" Color="Color.Warning" />
                                        </MudCardContent>
                                    </MudCard>
                                </MudItem>

                                <!-- Disk Usage -->
                                <MudItem xs="12" sm="4">
                                    <MudCard Class="pa-2" Elevation="2">
                                        <MudCardContent>
                                            <MudText Typo="Typo.subtitle1">@Localizer["disk usage"]: @diskUsage%</MudText>
                                            <MudProgressLinear Value="@diskUsage" Color="Color.Info" />
                                        </MudCardContent>
                                    </MudCard>
                                </MudItem>
                            </MudGrid>
                        </MudPaper>

                        @foreach (var server in servers)
                        {
                            DateTime lastHeartbeat;
                            bool isRecent = false;

                            try
                            {
                                // Try to parse the heartbeat timestamp
                                lastHeartbeat = DateTime.Parse(server.hearthbeat);
                                isRecent = (DateTime.Now - lastHeartbeat).TotalMinutes <= 10;
                            }
                            catch (Exception ex)
                            {
                                // Error handling for invalid or missing date
                                Logging.Handler.Error("Heartbeat-Parsing", "Error parsing server heartbeat", ex.ToString());
                            }

                            <MudPaper Class="mt-3">
                                <MudText Class="ml-2" Typo="Typo.h6">@server.name (@server.os) @(server.docker == "1" ? " (Docker)" : String.Empty)</MudText>
                                <MudText Class="ml-2" Typo="Typo.subtitle2">IP: @server.ip_address | Domain: @server.domain</MudText>

                                <MudText Class="ml-2" Typo="Typo.subtitle2" Color="@(isRecent ? Color.Success : Color.Error)">@Localizer["last hearthbeat"]: @server.hearthbeat</MudText>

                                <MudGrid>
                                    <!-- CPU Usage -->
                                    <MudItem xs="12" sm="4">
                                        <MudCard Class="pa-2" Elevation="2">
                                            <MudCardContent>
                                                <MudText Typo="Typo.subtitle1">@Localizer["cpu usage"]: @server.cpu_usage%</MudText>
                                                <MudProgressLinear Value="@Convert.ToDouble(server.cpu_usage)" Color="Color.Primary" />
                                            </MudCardContent>
                                        </MudCard>
                                    </MudItem>

                                    <!-- RAM Usage -->
                                    <MudItem xs="12" sm="4">
                                        <MudCard Class="pa-2" Elevation="2">
                                            <MudCardContent>
                                                <MudText Typo="Typo.subtitle1">@Localizer["ram usage"]: @server.ram_usage%</MudText>
                                                <MudProgressLinear Value="@Convert.ToDouble(server.ram_usage)" Color="Color.Warning" />
                                            </MudCardContent>
                                        </MudCard>
                                    </MudItem>

                                    <!-- Disk Usage -->
                                    <MudItem xs="12" sm="4">
                                        <MudCard Class="pa-2" Elevation="2">
                                            <MudCardContent>
                                                <MudText Typo="Typo.subtitle1">@Localizer["disk usage"]: @server.disk_usage%</MudText>
                                                <MudProgressLinear Value="@Convert.ToDouble(server.disk_usage)" Color="Color.Info" />
                                            </MudCardContent>
                                        </MudCard>
                                    </MudItem>
                                </MudGrid>

                                <MudExpansionPanel>
                                    <TitleContent>
                                        <div class="d-flex">
                                            <MudIcon Icon="@Icons.Material.Filled.SettingsApplications" class="mr-3"></MudIcon>
                                            <MudText>@Localizer["appsettings.json"]</MudText>
                                        </div>
                                    </TitleContent>

                                    <ChildContent>
                                        <MudTextField Class="ml-2 mr-2" T="string" Lines="20" Variant="Variant.Text" ReadOnly="true" @bind-Text="server.appsettings" />
                                    </ChildContent>

                                </MudExpansionPanel>
                            </MudPaper>
                        }

                    <!-- NetLock RMM File Server Status -->

                    <MudPaper Class="mt-3">
                        <MudText Class="ml-2" Typo="Typo.h6">@Localizer["NetLock RMM File Server"] (@Configuration.File_Server.Connection_String)</MudText>

                        <MudGrid>
                            <MudItem xs="12" sm="4">
                                <MudCard Class="pa-2" Elevation="2">
                                    <MudCardContent>

                                        <div style="display: flex; align-items: center;">
                                            @if (fileServerConnectionStatus)
                                            {
                                                <MudIcon Icon="@Icons.Material.Filled.CheckCircle" Color="Color.Success" />
                                                <MudText Class="ml-2" Color="Color.Success">@Localizer["connected"]</MudText>
                                            }
                                            else
                                            {
                                                <MudIcon Icon="@Icons.Material.Filled.Error" Color="Color.Error" />
                                                <MudText Class="ml-2" Color="Color.Error">@Localizer["not connected"]</MudText>
                                            }
                                        </div>

                                    </MudCardContent>
                                </MudCard>
                            </MudItem>
                        </MudGrid>

                    </MudPaper>

                    <MudPaper Class="mt-3">
                        <MudText Class="ml-2" Typo="Typo.h6">@Localizer["NetLock RMM Remote Server"] (@Configuration.Remote_Server.Connection_String)</MudText>

                        <MudGrid>
                            <!-- Remote Server Connection Status -->
                            <MudItem xs="12" sm="4">
                                <MudCard Class="pa-2" Elevation="2">
                                    <MudCardContent>

                                        <div style="display: flex; align-items: center;">

                                            @if (remoteServerConnectionStatus)
                                            {
                                                <MudIcon Icon="@Icons.Material.Filled.CheckCircle" Color="Color.Success" />
                                                <MudText Class="ml-2" Color="Color.Success">@Localizer["connected"]</MudText>
                                            }
                                            else
                                            {
                                                <MudIcon Icon="@Icons.Material.Filled.Error" Color="Color.Error" />
                                                <MudText Class="ml-2" Color="Color.Error">@Localizer["not connected"]</MudText>
                                            }

                                        </div>
                                    </MudCardContent>
                                </MudCard>
                            </MudItem>
                        </MudGrid>

                        @if (!_dnsWarning && !Configuration.Members_Portal.IsCloudEnabled && !remoteServerConnectionStatus && !fileServerConnectionStatus)
                        {
                            <MudAlert Class="mt-2 ml-2" Severity="Severity.Warning" Icon="@Icons.Material.Filled.Dns">PTR record mismatch detected! Your provided hostname resolves to: @_dnsWarningText but it should resolve to: @Configuration.Remote_Server.Hostname instead, according to your provided configuration. More details: https://docs.netlockrmm.com/en/troubleshooting/ptr-mismatch</MudAlert>
                        }

                        <MudButton Class="mt-2 ml-2 mb-3" Size="Size.Small" Variant="Variant.Filled" Color="Color.Default" StartIcon="@Icons.Material.Filled.NetworkCheck" OnClick="Test_Remote_File_Server_Connection">@Localizer["Check again"]</MudButton>

                    </MudPaper>

                </MudTabPanel>

                }
                    @if (!Configuration.Members_Portal.IsCloudEnabled)
                    {
                   <MudTabPanel Text="Licensing">
                        <MudPaper Class="mt-0 pa-4">
                            
                            <!-- Header Section -->
                            <MudText Typo="Typo.h5" Class="mb-4">
                                <MudIcon Icon="@Icons.Material.Filled.Key" Class="mr-2" />
                                @Localizer["Members Portal Api"]
                            </MudText>
                    
                            @if (!Configuration.Members_Portal.IsApiEnabled)
                            {
                                <MudAlert Severity="Severity.Warning" Icon="@Icons.Material.Filled.SyncDisabled" Class="mb-4">
                                    @Localizer["members portal api is not enabled. Please enable it in the appsettings.json"]
                                </MudAlert>
                            }
                            else
                            {
                                <!-- API Key Section (Read-Only) -->
                                <MudCard Elevation="2" Class="mb-4">
                                    <MudCardContent>
                                        <MudText Typo="Typo.h6" Class="mb-3">API Konfiguration</MudText>
                                        <MudTextField 
                                            T="string" 
                                            Variant="Variant.Outlined" 
                                            Label="@Localizer["enter your api key here"]" 
                                            @bind-Text="members_portal_api_key" 
                                            Immediate="true"
                                            FullWidth="true"
                                            ReadOnly="true"
                                            />
                                        <MudText Typo="Typo.caption" Class="mt-2" Color="Color.Secondary">
                                            The API key can only be changed in the appsettings.json.
                                        </MudText>
                                    </MudCardContent>
                                </MudCard>
                    
                                <!-- License Status Section -->
                                <MudCard Elevation="2" Class="mb-4">
                                    <MudCardContent>
                                        <MudText Typo="Typo.h6" Class="mb-3">@Localizer["license status"]</MudText>
                                        
                                        <!-- Status Badge -->
                                        <MudChip T="string" 
                                            Icon="@(members_portal_status == "Active" ? Icons.Material.Filled.CheckCircle : Icons.Material.Filled.Error)" 
                                            Color="@(members_portal_status == "Active" ? Color.Success : Color.Error)" 
                                            Size="Size.Medium"
                                            Class="mb-3">
                                            @(members_portal_status == "Active" ? Localizer["active"] : Localizer["expired"])
                                        </MudChip>
                    
                                        <MudDivider Class="my-3" />
                    
                                        <!-- License Details Grid -->
                                        <MudGrid>
                                            <MudItem xs="12" sm="6">
                                                <MudText Typo="Typo.body2" Class="mb-2">
                                                    <strong>Name:</strong> @members_portal_license_name
                                                </MudText>
                                            </MudItem>
                                            
                                            <MudItem xs="12" sm="6">
                                                <MudCard Outlined="true" Class="pa-3">
                                                    <MudCardContent Class="pa-2">
                                                        <div style="display: flex; align-items: center; gap: 8px;">
                                                            @if (members_portal_code_signed)
                                                            {
                                                                <MudIcon Icon="@Icons.Material.Filled.VerifiedUser" Color="Color.Success" Size="Size.Large" />
                                                                <div>
                                                                    <MudText Typo="Typo.body1" Color="Color.Success">
                                                                        <strong>Code signing enabled</strong>
                                                                    </MudText>
                                                                    <MudText Typo="Typo.caption" Color="Color.Success">
                                                                        Your Windows agents are code signed
                                                                    </MudText>
                                                                </div>
                                                            }
                                                            else
                                                            {
                                                                <MudIcon Icon="@Icons.Material.Filled.Shield" Color="Color.Default" Size="Size.Large" />
                                                                <div>
                                                                    <MudText Typo="Typo.body1">
                                                                        <strong>Code Signing not available</strong>
                                                                    </MudText>
                                                                    <MudText Typo="Typo.caption" Class="mb-2 mr-2">
                                                                        Available from Tier 1 for professional deployments
                                                                    </MudText>
                                                                    
                                                                    <MudButton 
                                                                        Size="Size.Small" 
                                                                        Variant="Variant.Filled" 
                                                                        Color="Color.Primary" 
                                                                        StartIcon="@Icons.Material.Filled.Upgrade"
                                                                        Href="https://www.netlockrmm.com/pricing.html"
                                                                        Target="_blank">
                                                                        Upgrade
                                                                    </MudButton>
                                                                </div>
                                                            }
                                                        </div>
                                                    </MudCardContent>
                                                </MudCard>
                                            </MudItem>
                                            
                                            <MudItem xs="12" sm="6">
                                                <MudText Typo="Typo.body2" Class="mb-2">
                                                    <strong>@Localizer["licenses used"]:</strong>
                                                    @members_portal_licenses_used / @members_portal_licenses_max
                                                </MudText>
                                                <MudProgressLinear
                                                    Color="Color.Info"
                                                    Value="@((double)members_portal_licenses_used / members_portal_licenses_max * 100)"
                                                    Size="Size.Small" />
                                            </MudItem>
                                        </MudGrid>
                    
                                        <MudButton 
                                            Class="mt-3" 
                                            Size="Size.Small" 
                                            Variant="Variant.Filled" 
                                            Color="Color.Info" 
                                            StartIcon="@Icons.Material.Filled.Update" 
                                            OnClick="Update_Members_Portal_License_Information" 
                                            Disabled="@(String.IsNullOrEmpty(members_portal_api_key))">
                                            @Localizer["refresh license information"]
                                        </MudButton>
                                    </MudCardContent>
                                </MudCard>
                            }
                    
                        </MudPaper>
                    </MudTabPanel>
                    }
                <MudTabPanel Text="Updates">
                    <MudPaper Class="mt-0 pa-4">
                        <MudText Typo="Typo.h6">Automatic Agent Updates</MudText>
                        
                        <MudAlert Class="mt-3 mb-4" Severity="Severity.Info" Icon="@Icons.Material.Filled.Info">
                            <strong>Global Master Switches:</strong> These settings act as global master switches for automatic agent updates.
                            <br/>‚Ä¢ When enabled here, you <strong>must also enable</strong> agent updates in the policy assigned to each device.
                            <br/>‚Ä¢ Both the global switch (here) AND the policy setting must be enabled for updates to work.
                            <br/>‚Ä¢ If disabled here, no automatic updates will occur regardless of policy settings.
                        </MudAlert>

                        <MudText Typo="Typo.subtitle1" Class="mb-2"><strong>Platform-specific Master Switches:</strong></MudText>
                        <MudSwitch Class="ml-2" @bind-Value="agent_updates_windows_enabled" Color="Color.Primary">Windows</MudSwitch>
                        <MudSwitch Class="ml-2" @bind-Value="agent_updates_linux_enabled" Color="Color.Primary">Linux</MudSwitch>
                        <MudSwitch Class="ml-2" @bind-Value="agent_updates_macos_enabled" Color="Color.Primary">MacOS</MudSwitch>
                        
                        <MudDivider Class="my-4" />
                        
                        <MudText Typo="Typo.subtitle1" Class="mb-2"><strong>Concurrent Limit:</strong></MudText>
                        
                        <MudAlert Class="mb-3" Severity="Severity.Info" Icon="@Icons.Material.Filled.Rocket">
                            <strong>NetLock State-of-the-Art High-Performance Backend:</strong>
                            <br/>‚Ä¢ NetLock uses a cutting-edge high-performance backend that loads and caches installation packages in RAM
                            <br/>‚Ä¢ This state-of-the-art architecture means the primary limitation is your available <strong>network bandwidth</strong>, not CPU or memory
                            <br/>‚Ä¢ Massive rollouts are possible with minimal resource impact on the backend server
                            <br/>‚Ä¢ The concurrent limit mainly controls how many simultaneous network connections are used
                            <br/>‚Ä¢ Perfect for enterprise-scale deployments with thousands of agents
                        </MudAlert>

                        <MudAlert Class="mb-3" Severity="Severity.Warning" Icon="@Icons.Material.Filled.Speed">
                            <strong>Controls concurrent agent installations & updates:</strong>
                            <br/>‚Ä¢ Applies to both automatic agent updates AND initial agent installations via installer
                            <br/>‚Ä¢ Limits how many agents can be installed/updated simultaneously by the backend
                            <br/>‚Ä¢ Choose a value appropriate for your available <strong>bandwidth</strong>
                            <br/>‚Ä¢ Lower values prevent bandwidth saturation and network congestion
                            <br/>‚Ä¢ Higher values allow faster rollout if you have sufficient bandwidth available
                            <br/>‚Ä¢ <strong>Note:</strong> Consider your MySQL database server resources, as each installation/update process writes to the database in the background
                        </MudAlert>
                        
                        <MudNumericField 
                            Class="ml-2" 
                            @bind-Value="agent_updates_max_concurrent_updates" 
                            Label="Max concurrent installations & updates"
                            Variant="Variant.Text" 
                            Min="1" 
                            Max="@(Configuration.Members_Portal.IsCloudEnabled ? 50 : 9999)" 
                            Style="max-width: 350px;" />
                        
                        <MudButton Class="ml-2 mt-3 mb-2" Size="Size.Small" Variant="Variant.Filled" Color="Color.Success" StartIcon="@Icons.Material.Filled.Save" OnClick="@SaveAgentUpdates">Save</MudButton>
                    </MudPaper>
                </MudTabPanel>
                @if (!Configuration.Members_Portal.IsCloudEnabled)
                {
                    <MudTabPanel Text="Database">
                        <MudPaper Class="mt-0 pa-4">
                            <MudText Typo="Typo.h6">Clean Up & Optimize Database</MudText>
                            <MudText Class="mt-2" Typo="Typo.body1">
                                Automatic cleanup of historical database entries to manage storage space and optimize performance.
                            </MudText>

                            <MudAlert Class="mt-3 mb-4" Severity="Severity.Warning" Icon="@Icons.Material.Filled.Storage">
                                <strong>Important: Data Storage Considerations</strong>
                                <br/>‚Ä¢ With many devices and <strong>short sync intervals</strong> (configured in policies), the database can grow to <strong>very large sizes</strong>
                                <br/>‚Ä¢ Historical data accumulates rapidly and can consume significant disk storage
                                <br/>‚Ä¢ Regular cleanup is essential to prevent database performance degradation and storage issues
                                <br/>‚Ä¢ Consider your available disk space when setting retention periods
                            </MudAlert>

                            <MudGrid>
                                <MudItem xs="12" md="6">
                                    <MudCard Class="ml-2 mb-4">
                                        <MudCardContent>
                                            <MudCheckBox T="bool" @bind-Value="cleanup_applications_drivers_history_enabled" Label="Applications Drivers History" Color="Color.Primary" />
                                            <MudText Typo="Typo.caption" Class="mb-2" Style="color: var(--mud-palette-text-secondary);"><strong>Very high volume data.</strong> Historical data of installed drivers on devices. Recommended: <strong>30-60 days</strong>.</MudText>
                                            <MudNumericField Class="mt-2" @bind-Value="cleanup_applications_drivers_history_days" Label="Older than X days" Variant="Variant.Text" Min="1" Max="9999" />
                                        </MudCardContent>
                                    </MudCard>
                                </MudItem>

                                <MudItem xs="12" md="6">
                                    <MudCard Class="ml-2 mb-4">
                                        <MudCardContent>
                                            <MudCheckBox T="bool" @bind-Value="cleanup_applications_installed_history_enabled" Label="Applications Installed History" Color="Color.Primary" />
                                            <MudText Typo="Typo.caption" Class="mb-2" Style="color: var(--mud-palette-text-secondary);"><strong>Very high volume data.</strong> Historical data of installed applications. Useful for tracking software changes. Recommended: <strong>30-60 days</strong>.</MudText>
                                            <MudNumericField Class="mt-2" @bind-Value="cleanup_applications_installed_history_days" Label="Older than X days" Variant="Variant.Text" Min="1" Max="9999" />
                                        </MudCardContent>
                                    </MudCard>
                                </MudItem>

                                <MudItem xs="12" md="6">
                                    <MudCard Class="ml-2 mb-4">
                                        <MudCardContent>
                                            <MudCheckBox T="bool" @bind-Value="cleanup_applications_logon_history_enabled" Label="Applications Logon History" Color="Color.Primary" />
                                            <MudText Typo="Typo.caption" Class="mb-2" Style="color: var(--mud-palette-text-secondary);"><strong>Very high volume data.</strong> User logon history and session data. Recommended: <strong>30-60 days</strong>.</MudText>
                                            <MudNumericField Class="mt-2" @bind-Value="cleanup_applications_logon_history_days" Label="Older than X days" Variant="Variant.Text" Min="1" Max="9999" />
                                        </MudCardContent>
                                    </MudCard>
                                </MudItem>

                                <MudItem xs="12" md="6">
                                    <MudCard Class="ml-2 mb-4">
                                        <MudCardContent>
                                            <MudCheckBox T="bool" @bind-Value="cleanup_applications_scheduled_tasks_history_enabled" Label="Applications Scheduled Tasks History" Color="Color.Primary" />
                                            <MudText Typo="Typo.caption" Class="mb-2" Style="color: var(--mud-palette-text-secondary);"><strong>Very high volume data.</strong> Historical data of scheduled tasks changes. Recommended: <strong>30-60 days</strong>.</MudText>
                                            <MudNumericField Class="mt-2" @bind-Value="cleanup_applications_scheduled_tasks_history_days" Label="Older than X days" Variant="Variant.Text" Min="1" Max="9999" />
                                        </MudCardContent>
                                    </MudCard>
                                </MudItem>

                                <MudItem xs="12" md="6">
                                    <MudCard Class="ml-2 mb-4">
                                        <MudCardContent>
                                            <MudCheckBox T="bool" @bind-Value="cleanup_applications_services_history_enabled" Label="Applications Services History" Color="Color.Primary" />
                                            <MudText Typo="Typo.caption" Class="mb-2" Style="color: var(--mud-palette-text-secondary);"><strong>Very high volume data.</strong> Historical data of Windows/Linux/macOS services. Recommended: <strong>30-60 days</strong>.</MudText>
                                            <MudNumericField Class="mt-2" @bind-Value="cleanup_applications_services_history_days" Label="Older than X days" Variant="Variant.Text" Min="1" Max="9999" />
                                        </MudCardContent>
                                    </MudCard>
                                </MudItem>

                                <MudItem xs="12" md="6">
                                    <MudCard Class="ml-2 mb-4">
                                        <MudCardContent>
                                            <MudCheckBox T="bool" @bind-Value="cleanup_device_information_antivirus_products_history_enabled" Label="Device Information Antivirus Products History" Color="Color.Primary" />
                                            <MudText Typo="Typo.caption" Class="mb-2" Style="color: var(--mud-palette-text-secondary);"><strong>Very high volume data.</strong> Antivirus product status and configuration history. Recommended: <strong>60-90 days</strong>.</MudText>
                                            <MudNumericField Class="mt-2" @bind-Value="cleanup_device_information_antivirus_products_history_days" Label="Older than X days" Variant="Variant.Text" Min="1" Max="9999" />
                                        </MudCardContent>
                                    </MudCard>
                                </MudItem>

                                <MudItem xs="12" md="6">
                                    <MudCard Class="ml-2 mb-4">
                                        <MudCardContent>
                                            <MudCheckBox T="bool" @bind-Value="cleanup_device_information_cpu_history_enabled" Label="Device information CPU history" Color="Color.Primary" />
                                            <MudText Typo="Typo.caption" Class="mb-2" Style="color: var(--mud-palette-text-secondary);">CPU usage metrics. High volume data with short sync intervals. Recommended: 30-90 days.</MudText>
                                            <MudNumericField Class="mt-2" @bind-Value="cleanup_device_information_cpu_history_days" Label="Older than X days" Variant="Variant.Text" Min="1" Max="9999" />
                                        </MudCardContent>
                                    </MudCard>
                                </MudItem>

                                <MudItem xs="12" md="6">
                                    <MudCard Class="ml-2 mb-4">
                                        <MudCardContent>
                                            <MudCheckBox T="bool" @bind-Value="cleanup_device_information_cronjobs_history_enabled" Label="Device information cronjobs history" Color="Color.Primary" />
                                            <MudText Typo="Typo.caption" Class="mb-2" Style="color: var(--mud-palette-text-secondary);">Cronjob configuration history (Linux/macOS). Recommended: 90-180 days.</MudText>
                                            <MudNumericField Class="mt-2" @bind-Value="cleanup_device_information_cronjobs_history_days" Label="Older than X days" Variant="Variant.Text" Min="1" Max="9999" />
                                        </MudCardContent>
                                    </MudCard>
                                </MudItem>

                                <MudItem xs="12" md="6">
                                    <MudCard Class="ml-2 mb-4">
                                        <MudCardContent>
                                            <MudCheckBox T="bool" @bind-Value="cleanup_device_information_disks_history_enabled" Label="Device information disks history" Color="Color.Primary" />
                                            <MudText Typo="Typo.caption" Class="mb-2" Style="color: var(--mud-palette-text-secondary);">Disk space usage metrics. High volume data. Recommended: 30-90 days.</MudText>
                                            <MudNumericField Class="mt-2" @bind-Value="cleanup_device_information_disks_history_days" Label="Older than X days" Variant="Variant.Text" Min="1" Max="9999" />
                                        </MudCardContent>
                                    </MudCard>
                                </MudItem>

                                <MudItem xs="12" md="6">
                                    <MudCard Class="ml-2 mb-4">
                                        <MudCardContent>
                                            <MudCheckBox T="bool" @bind-Value="cleanup_device_information_general_history_enabled" Label="Device information general history" Color="Color.Primary" />
                                            <MudText Typo="Typo.caption" Class="mb-2" Style="color: var(--mud-palette-text-secondary);"><strong>Very high volume data.</strong> General device information changes (hostname, OS version, etc.). Recommended: <strong>60-90 days</strong>.</MudText>
                                            <MudNumericField Class="mt-2" @bind-Value="cleanup_device_information_general_history_days" Label="Older than X days" Variant="Variant.Text" Min="1" Max="9999" />
                                        </MudCardContent>
                                    </MudCard>
                                </MudItem>

                                <MudItem xs="12" md="6">
                                    <MudCard Class="ml-2 mb-4">
                                        <MudCardContent>
                                            <MudCheckBox T="bool" @bind-Value="cleanup_device_information_history_enabled" Label="Device information history" Color="Color.Primary" />
                                            <MudText Typo="Typo.caption" Class="mb-2" Style="color: var(--mud-palette-text-secondary);">Device configuration history snapshots. Recommended: 180-365 days.</MudText>
                                            <MudNumericField Class="mt-2" @bind-Value="cleanup_device_information_history_days" Label="Older than X days" Variant="Variant.Text" Min="1" Max="9999" />
                                        </MudCardContent>
                                    </MudCard>
                                </MudItem>

                                <MudItem xs="12" md="6">
                                    <MudCard Class="ml-2 mb-4">
                                        <MudCardContent>
                                            <MudCheckBox T="bool" @bind-Value="cleanup_device_information_network_adapters_history_enabled" Label="Device information network adapters history" Color="Color.Primary" />
                                            <MudText Typo="Typo.caption" Class="mb-2" Style="color: var(--mud-palette-text-secondary);">Network adapter configuration history. Recommended: 90-180 days.</MudText>
                                            <MudNumericField Class="mt-2" @bind-Value="cleanup_device_information_network_adapters_history_days" Label="Older than X days" Variant="Variant.Text" Min="1" Max="9999" />
                                        </MudCardContent>
                                    </MudCard>
                                </MudItem>

                                <MudItem xs="12" md="6">
                                    <MudCard Class="ml-2 mb-4">
                                        <MudCardContent>
                                            <MudCheckBox T="bool" @bind-Value="cleanup_device_information_ram_history_enabled" Label="Device information RAM history" Color="Color.Primary" />
                                            <MudText Typo="Typo.caption" Class="mb-2" Style="color: var(--mud-palette-text-secondary);">RAM usage metrics. High volume data with short sync intervals. Recommended: 30-90 days.</MudText>
                                            <MudNumericField Class="mt-2" @bind-Value="cleanup_device_information_ram_history_days" Label="Older than X days" Variant="Variant.Text" Min="1" Max="9999" />
                                        </MudCardContent>
                                    </MudCard>
                                </MudItem>

                                <MudItem xs="12" md="6">
                                    <MudCard Class="ml-2 mb-4">
                                        <MudCardContent>
                                            <MudCheckBox T="bool" @bind-Value="cleanup_device_information_task_manager_history_enabled" Label="Device information task manager history" Color="Color.Primary" />
                                            <MudText Typo="Typo.caption" Class="mb-2" Style="color: var(--mud-palette-text-secondary);"><strong>Extremely high volume data!</strong> Running processes history. Can grow rapidly with short sync intervals. Recommended: <strong>7-30 days</strong>.</MudText>
                                            <MudNumericField Class="mt-2" @bind-Value="cleanup_device_information_task_manager_history_days" Label="Older than X days" Variant="Variant.Text" Min="1" Max="9999" />
                                        </MudCardContent>
                                    </MudCard>
                                </MudItem>

                                <MudItem xs="12" md="6">
                                    <MudCard Class="ml-2 mb-4">
                                        <MudCardContent>
                                            <MudCheckBox T="bool" @bind-Value="cleanup_events_history_enabled" Label="Events history" Color="Color.Primary" />
                                            <MudText Typo="Typo.caption" Class="mb-2" Style="color: var(--mud-palette-text-secondary);"><strong>Critical:</strong> Sensor events, job execution logs, and system events. <strong>Minimum recommended: 365 days</strong> for compliance and audit purposes.</MudText>
                                            <MudNumericField Class="mt-2" @bind-Value="cleanup_events_history_days" Label="Older than X days" Variant="Variant.Text" Min="1" Max="9999" />
                                        </MudCardContent>
                                    </MudCard>
                                </MudItem>

                            </MudGrid>

                            <MudButton Class="ml-2 mt-2 mb-3" Size="Size.Small" Variant="Variant.Filled" Color="Color.Success" StartIcon="@Icons.Material.Filled.Save" OnClick="@Save_Cleanup_Settings">Save</MudButton>
                            <MudButton Class="ml-2 mt-2 mb-3" Size="Size.Small" Variant="Variant.Filled" Color="Color.Default" StartIcon="@Icons.Material.Filled.Refresh" OnClick="@Optimize_Database">Optimize Database</MudButton>
                        </MudPaper>
                    </MudTabPanel>
                }
                <MudTabPanel Text="Remote Screen Control">
                    <MudPaper Class="mt-0 mb-0">
                        
                        <MudText Class="ml-2" Typo="Typo.h6">Remote Screen Control Recording</MudText>
                        <MudSwitch Class="ml-2" Color="Color.Primary" @bind-Value="remoteScreenSessionRecordingForced" Label="Force session recording"></MudSwitch>
                        <MudText Class="ml-2 mt-2" Typo="Typo.body1">When enabled, all remote screen control sessions will be recorded by the server.</MudText>

                        <MudCheckBox T="bool" @bind-Value="remoteScreenSessionRecordingAutoClean" Label="Auto purge" Color="Color.Primary" />

                        @if (Configuration.Members_Portal.IsCloudEnabled)
                        {
                            <MudText Class="ml-2 mt-2" Typo="Typo.body1">Your recordings will be kept for seven days.</MudText>
                        }
                        else
                        {
                            <MudNumericField Class="ml-2 mt-2" @bind-Value="remoteScreenSessionRecordingForcedDays" Label="Older than X days" Variant="Variant.Text" Min="1" Max="9999" />
                        }

                        <MudButton Class="ml-2 mt-2 mb-3" Size="Size.Small" Variant="Variant.Filled" Color="Color.Success" StartIcon="@Icons.Material.Filled.Save" OnClick="@SaveRemoteScreenSessionRecordingSettings">Save</MudButton>
                    </MudPaper>
                </MudTabPanel>

                <MudTabPanel Text="IP Whitelist">
                        <MudTabs Class="mt-0" Elevation="2" Rounded="true" ApplyEffectsToContainer="true">
                            
                            <!-- Web Console IP Whitelist -->
                            <MudTabPanel Text="Web Console" Icon="@Icons.Material.Filled.Computer">
                                <MudPaper Class="mt-0">
                                    <MudText Class="ml-2" Typo="Typo.h6">IP Whitelist for Web Console</MudText>
                                    
                                    <MudAlert Class="mt-2 ml-2 mr-2" Severity="Severity.Info" Icon="@Icons.Material.Filled.Info">
                                        Configure IP addresses that are allowed to access the Web Console. Enter IP addresses separated by commas.<br/>
                                        Leave empty to allow access from all IPs. <strong>The application will restart after saving.</strong>
                                    </MudAlert>
                                    
                                    <MudTextField 
                                        Class="ml-2 mr-2 mt-3" 
                                        T="string" 
                                        Variant="Variant.Outlined" 
                                        Label="Allowed IP Addresses (comma-separated)" 
                                        @bind-Value="ipWhitelistWebConsoleInput" 
                                        Lines="5"
                                        Immediate="true"
                                        HelperText="Example: 192.168.1.100, 10.0.0.5, 172.16.0.1" />
                                    
                                    @if (!string.IsNullOrEmpty(ipWhitelistWebConsoleValidationError))
                                    {
                                        <MudAlert Class="mt-2 ml-2 mr-2" Severity="Severity.Error" Icon="@Icons.Material.Filled.Error">
                                            @ipWhitelistWebConsoleValidationError
                                        </MudAlert>
                                    }
                                    
                                    <MudButton Class="ml-2 mt-3 mb-3" Size="Size.Small" Variant="Variant.Filled" Color="Color.Success" StartIcon="@Icons.Material.Filled.Save" OnClick="@SaveIpWhitelistWebConsole">Save & Restart</MudButton>
                                </MudPaper>
                            </MudTabPanel>
                            
                            <!-- Backend IP Whitelist -->
                            <MudTabPanel Text="Backend" Icon="@Icons.Material.Filled.Dns">
                                <MudPaper Class="mt-0">
                                    <MudText Class="ml-2" Typo="Typo.h6">IP Whitelist for Backend</MudText>
                                    
                                    <MudAlert Class="mt-2 ml-2 mr-2" Severity="Severity.Info" Icon="@Icons.Material.Filled.Info">
                                        Configure IP addresses that are allowed to access the Backend services. Enter IP addresses separated by commas.<br/>
                                        Leave empty to allow access from all IPs. <strong>This configuration will be applied when the backend services restart.</strong>
                                    </MudAlert>
                                    
                                    <MudTextField 
                                        Class="ml-2 mr-2 mt-3" 
                                        T="string" 
                                        Variant="Variant.Outlined" 
                                        Label="Allowed IP Addresses (comma-separated)" 
                                        @bind-Value="ipWhitelistBackendInput" 
                                        Lines="5"
                                        Immediate="true"
                                        HelperText="Example: 192.168.1.100, 10.0.0.5, 172.16.0.1" />
                                    
                                    @if (!string.IsNullOrEmpty(ipWhitelistBackendValidationError))
                                    {
                                        <MudAlert Class="mt-2 ml-2 mr-2" Severity="Severity.Error" Icon="@Icons.Material.Filled.Error">
                                            @ipWhitelistBackendValidationError
                                        </MudAlert>
                                    }
                                    
                                    <MudButton Class="ml-2 mt-3 mb-3" Size="Size.Small" Variant="Variant.Filled" Color="Color.Success" StartIcon="@Icons.Material.Filled.Save" OnClick="@SaveIpWhitelistBackend">Save</MudButton>
                                </MudPaper>
                            </MudTabPanel>
                            
                        </MudTabs>
                    </MudTabPanel>
                    
                    <MudTabPanel Text="Single Sign-On (SSO)">
                        <MudPaper Class="mt-0">
                            <MudText Class="ml-2" Typo="Typo.h6">Single Sign-On Configuration</MudText>
                            
                            @if (Configuration.Sso.ConfigurationError)
                            {
                                <MudAlert Class="mt-2 ml-2 mr-2" Severity="Severity.Error" Icon="@Icons.Material.Filled.Error">
                                    <strong>SSO Configuration Error!</strong><br/>
                                    The SSO configuration could not be loaded during application startup and SSO is currently <strong>DISABLED</strong>.<br/>
                                    <br/>
                                    <strong>Error:</strong> @Configuration.Sso.ConfigurationErrorMessage<br/>
                                    <br/>
                                    Please verify your SSO configuration below and save it. The application will automatically restart after saving.
                                </MudAlert>
                            }
                            
                            <MudAlert Class="mt-2 ml-2 mr-2" Severity="Severity.Info" Icon="@Icons.Material.Filled.Info">
                                You can only enable <strong>one SSO provider</strong> at a time. Enabling a new provider will automatically disable the others.
                            </MudAlert>
                            
                            <MudTabs Class="mt-3" Elevation="2" Rounded="true" ApplyEffectsToContainer="true" PanelClass="pa-6">
                                
                                <!-- Azure AD -->
                                <MudTabPanel Text="Azure AD" Icon="@Icons.Material.Filled.Cloud">
                                    <MudSwitch Class="mb-3" Color="Color.Primary" Value="@azureAdEnabled" ValueChanged="@((bool val) => OnProviderEnabledChanged(val, "AzureAd"))" Label="Enable Azure AD"></MudSwitch>
                                    
                                    <MudTextField Class="mb-2" @bind-Value="azureAdInstance" Label="Instance" Variant="Variant.Outlined" HelperText="e.g., https://login.microsoftonline.com/" />
                                    <MudTextField Class="mb-2" @bind-Value="azureAdDomain" Label="Domain" Variant="Variant.Outlined" HelperText="e.g., your-domain.onmicrosoft.com" />
                                    <MudTextField Class="mb-2" @bind-Value="azureAdTenantId" Label="Tenant ID" Variant="Variant.Outlined" />
                                    <MudTextField Class="mb-2" @bind-Value="azureAdClientId" Label="Client ID" Variant="Variant.Outlined" />
                                    <MudTextField Class="mb-2" @bind-Value="azureAdClientSecret" Label="Client Secret" Variant="Variant.Outlined" InputType="InputType.Password" />
                                    <MudTextField Class="mb-2" @bind-Value="azureAdCallbackPath" Label="Callback Path" Variant="Variant.Outlined" HelperText="e.g., /signin-oidc" />
                                    <MudTextField Class="mb-2" @bind-Value="azureAdSignedOutCallbackPath" Label="Signed Out Callback Path" Variant="Variant.Outlined" HelperText="e.g., /signout-callback-oidc" />
                                    <MudTextField Class="mb-2" @bind-Value="azureAdResponseType" Label="Response Type" Variant="Variant.Outlined" HelperText="e.g., code" />
                                    <MudSwitch Class="mb-3" Color="Color.Primary" @bind-Value="azureAdSaveTokens" Label="Save Tokens"></MudSwitch>
                                </MudTabPanel>

                                <!-- Keycloak -->
                                <MudTabPanel Text="Keycloak" Icon="@Icons.Material.Filled.Security">
                                    <MudSwitch Class="mb-3" Color="Color.Primary" Value="@keycloakEnabled" ValueChanged="@((bool val) => OnProviderEnabledChanged(val, "Keycloak"))" Label="Enable Keycloak"></MudSwitch>
                                    
                                    <MudTextField Class="mb-2" @bind-Value="keycloakAuthority" Label="Authority" Variant="Variant.Outlined" HelperText="e.g., https://keycloak.example.com/realms/your-realm" />
                                    <MudTextField Class="mb-2" @bind-Value="keycloakRealm" Label="Realm" Variant="Variant.Outlined" />
                                    <MudTextField Class="mb-2" @bind-Value="keycloakClientId" Label="Client ID" Variant="Variant.Outlined" />
                                    <MudTextField Class="mb-2" @bind-Value="keycloakClientSecret" Label="Client Secret" Variant="Variant.Outlined" InputType="InputType.Password" />
                                    <MudTextField Class="mb-2" @bind-Value="keycloakCallbackPath" Label="Callback Path" Variant="Variant.Outlined" HelperText="e.g., /signin-keycloak" />
                                    <MudTextField Class="mb-2" @bind-Value="keycloakSignedOutCallbackPath" Label="Signed Out Callback Path" Variant="Variant.Outlined" HelperText="e.g., /signout-callback-keycloak" />
                                    <MudTextField Class="mb-2" @bind-Value="keycloakResponseType" Label="Response Type" Variant="Variant.Outlined" HelperText="e.g., code" />
                                    <MudSwitch Class="mb-2" Color="Color.Primary" @bind-Value="keycloakSaveTokens" Label="Save Tokens"></MudSwitch>
                                    <MudSwitch Class="mb-2" Color="Color.Primary" @bind-Value="keycloakGetClaimsFromUserInfoEndpoint" Label="Get Claims From UserInfo Endpoint"></MudSwitch>
                                    <MudSwitch Class="mb-3" Color="Color.Primary" @bind-Value="keycloakRequireHttpsMetadata" Label="Require HTTPS Metadata"></MudSwitch>
                                </MudTabPanel>

                                <!-- Google Identity -->
                                <MudTabPanel Text="Google" Icon="@Icons.Custom.Brands.Google">
                                    <MudSwitch Class="mb-3" Color="Color.Primary" Value="@googleEnabled" ValueChanged="@((bool val) => OnProviderEnabledChanged(val, "Google"))" Label="Enable Google Identity"></MudSwitch>
                                    
                                    <MudTextField Class="mb-2" @bind-Value="googleClientId" Label="Client ID" Variant="Variant.Outlined" HelperText="e.g., your-client-id.apps.googleusercontent.com" />
                                    <MudTextField Class="mb-2" @bind-Value="googleClientSecret" Label="Client Secret" Variant="Variant.Outlined" InputType="InputType.Password" />
                                    <MudTextField Class="mb-2" @bind-Value="googleCallbackPath" Label="Callback Path" Variant="Variant.Outlined" HelperText="e.g., /signin-google" />
                                    <MudTextField Class="mb-2" @bind-Value="googleSignedOutCallbackPath" Label="Signed Out Callback Path" Variant="Variant.Outlined" HelperText="e.g., /signout-callback-google" />
                                    <MudTextField Class="mb-2" @bind-Value="googleHostedDomain" Label="Hosted Domain (Optional)" Variant="Variant.Outlined" HelperText="Restrict to specific Google Workspace domain" />
                                    <MudSwitch Class="mb-3" Color="Color.Primary" @bind-Value="googleSaveTokens" Label="Save Tokens"></MudSwitch>
                                </MudTabPanel>

                                <!-- Okta -->
                                <MudTabPanel Text="Okta" Icon="@Icons.Material.Filled.VpnKey">
                                    <MudSwitch Class="mb-3" Color="Color.Primary" Value="@oktaEnabled" ValueChanged="@((bool val) => OnProviderEnabledChanged(val, "Okta"))" Label="Enable Okta"></MudSwitch>
                                    
                                    <MudTextField Class="mb-2" @bind-Value="oktaDomain" Label="Domain" Variant="Variant.Outlined" HelperText="e.g., dev-12345.okta.com" />
                                    <MudTextField Class="mb-2" @bind-Value="oktaClientId" Label="Client ID" Variant="Variant.Outlined" />
                                    <MudTextField Class="mb-2" @bind-Value="oktaClientSecret" Label="Client Secret" Variant="Variant.Outlined" InputType="InputType.Password" />
                                    <MudTextField Class="mb-2" @bind-Value="oktaCallbackPath" Label="Callback Path" Variant="Variant.Outlined" HelperText="e.g., /signin-okta" />
                                    <MudTextField Class="mb-2" @bind-Value="oktaSignedOutCallbackPath" Label="Signed Out Callback Path" Variant="Variant.Outlined" HelperText="e.g., /signout-callback-okta" />
                                    <MudTextField Class="mb-2" @bind-Value="oktaAuthorizationServerId" Label="Authorization Server ID (Optional)" Variant="Variant.Outlined" HelperText="e.g., default" />
                                    <MudSwitch Class="mb-2" Color="Color.Primary" @bind-Value="oktaSaveTokens" Label="Save Tokens"></MudSwitch>
                                    <MudSwitch Class="mb-3" Color="Color.Primary" @bind-Value="oktaGetClaimsFromUserInfoEndpoint" Label="Get Claims From UserInfo Endpoint"></MudSwitch>
                                </MudTabPanel>

                                <!-- Auth0 -->
                                <MudTabPanel Text="Auth0" Icon="@Icons.Material.Filled.Lock">
                                    <MudSwitch Class="mb-3" Color="Color.Primary" Value="@auth0Enabled" ValueChanged="@((bool val) => OnProviderEnabledChanged(val, "Auth0"))" Label="Enable Auth0"></MudSwitch>
                                    
                                    <MudTextField Class="mb-2" @bind-Value="auth0Domain" Label="Domain" Variant="Variant.Outlined" HelperText="e.g., your-tenant.auth0.com" />
                                    <MudTextField Class="mb-2" @bind-Value="auth0ClientId" Label="Client ID" Variant="Variant.Outlined" />
                                    <MudTextField Class="mb-2" @bind-Value="auth0ClientSecret" Label="Client Secret" Variant="Variant.Outlined" InputType="InputType.Password" />
                                    <MudTextField Class="mb-2" @bind-Value="auth0CallbackPath" Label="Callback Path" Variant="Variant.Outlined" HelperText="e.g., /signin-auth0" />
                                    <MudTextField Class="mb-2" @bind-Value="auth0SignedOutCallbackPath" Label="Signed Out Callback Path" Variant="Variant.Outlined" HelperText="e.g., /signout-callback-auth0" />
                                    <MudTextField Class="mb-2" @bind-Value="auth0Audience" Label="Audience (Optional)" Variant="Variant.Outlined" HelperText="API Identifier for custom API" />
                                    <MudSwitch Class="mb-3" Color="Color.Primary" @bind-Value="auth0SaveTokens" Label="Save Tokens"></MudSwitch>
                                </MudTabPanel>

                            </MudTabs>

                            <MudButton Class="ml-2 mt-3 mb-3" Size="Size.Small" Variant="Variant.Filled" Color="Color.Success" StartIcon="@Icons.Material.Filled.Save" OnClick="@SaveSsoSettings">Save</MudButton>
                        </MudPaper>
                    </MudTabPanel>
                    
                    <MudTabPanel Text="Whitelabeling">
                        <MudTabs Class="mt-0" Elevation="2" Rounded="true" ApplyEffectsToContainer="true">
                            
                            <!-- Web Console Title -->
                            <MudTabPanel Text="Web Console Title" Icon="@Icons.Material.Filled.Title">
                                <MudPaper Class="mt-0">
                                    <MudAlert Class="ml-2 mr-2" Severity="Severity.Info" Icon="@Icons.Material.Filled.Info">
                                        Configure the title that will be displayed in the web console.<br/>
                                        <strong>Changes will apply after the web console application has been restarted.</strong>
                                    </MudAlert>
                                    
                                    <MudTextField 
                                        Class="ml-2 mr-2 mt-3" 
                                        T="string" 
                                        Variant="Variant.Outlined" 
                                        Label="Web Console Title" 
                                        @bind-Value="webConsoleTitleInput" 
                                        Immediate="true"
                                        HelperText="Example: NetLock RMM" />
                                    
                                    @if (!string.IsNullOrEmpty(webConsoleTitleValidationError))
                                    {
                                        <MudAlert Class="mt-2 ml-2 mr-2" Severity="Severity.Error" Icon="@Icons.Material.Filled.Error">
                                            @webConsoleTitleValidationError
                                        </MudAlert>
                                    }
                                    
                                    <MudButton Class="ml-2 mt-3 mb-3" Size="Size.Small" Variant="Variant.Filled" Color="Color.Success" StartIcon="@Icons.Material.Filled.Save" OnClick="@SaveWebConsoleTitle">Save & Restart</MudButton>
                                </MudPaper>
                            </MudTabPanel>
                            
                            <!-- Web Console Logo -->
                            <MudTabPanel Text="Web Console Logo" Icon="@Icons.Material.Filled.Image">
                                <MudPaper Class="mt-0">
                                    <MudAlert Class="ml-2 mr-2" Severity="Severity.Info" Icon="@Icons.Material.Filled.Info">
                                        Upload a custom logo for the web console. Recommended size: 200x50 pixels (PNG or JPG).<br/>
                                        <strong>Changes will apply after the web console application has been restarted.</strong>
                                    </MudAlert>
                                    
                                    <!-- Current Logo Preview -->
                                    @if (!string.IsNullOrEmpty(webConsoleLogoBase64))
                                    {
                                        <MudText Class="ml-2 mt-3" Typo="Typo.subtitle2">Current Logo:</MudText>
                                        <MudPaper Class="ml-2 mr-2 mt-2 pa-3" Elevation="0" Style="border: 1px solid #ccc; max-width: 400px;">
                                            <img src="@($"data:image/png;base64,{webConsoleLogoBase64}")" alt="Current Logo" style="max-width: 100%; height: auto; max-height: 100px;" />
                                        </MudPaper>
                                    }
                                    
                                    <!-- File Upload -->
                                    <MudFileUpload T="IBrowserFile"
                                                   Class="ml-2 mr-2 mt-3"
                                                   Accept="image/png,image/jpeg,image/jpg"
                                                   FilesChanged="@OnLogoFileSelected"
                                                   MaximumFileCount="1">
                                        <ButtonTemplate>
                                            <MudButton HtmlTag="label"
                                                       Variant="Variant.Filled"
                                                       Color="Color.Primary"
                                                       StartIcon="@Icons.Material.Filled.CloudUpload"
                                                       for="@context">
                                                Choose Logo File
                                            </MudButton>
                                        </ButtonTemplate>
                                    </MudFileUpload>
                                    
                                    @if (!string.IsNullOrEmpty(selectedLogoFileName))
                                    {
                                        <MudText Class="ml-2 mt-2" Typo="Typo.body2">Selected file: @selectedLogoFileName</MudText>
                                    }
                                    
                                    <!-- New Logo Preview -->
                                    @if (!string.IsNullOrEmpty(webConsoleLogoPreviewBase64))
                                    {
                                        <MudText Class="ml-2 mt-3" Typo="Typo.subtitle2">Preview:</MudText>
                                        <MudPaper Class="ml-2 mr-2 mt-2 pa-3" Elevation="0" Style="border: 1px solid #ccc; max-width: 400px;">
                                            <img src="@($"data:image/png;base64,{webConsoleLogoPreviewBase64}")" alt="Logo Preview" style="max-width: 100%; height: auto; max-height: 100px;" />
                                        </MudPaper>
                                    }

                                    @if (!string.IsNullOrEmpty(webConsoleLogoValidationError))
                                    {
                                        <MudAlert Class="mt-2 ml-2 mr-2" Severity="Severity.Error" Icon="@Icons.Material.Filled.Error">
                                            @webConsoleLogoValidationError
                                        </MudAlert>
                                    }
                                    
                                    <MudStack Row="true" Class="ml-2 mt-3 mb-3">
                                        <MudButton Size="Size.Small" 
                                                   Variant="Variant.Filled" 
                                                   Color="Color.Success" 
                                                   StartIcon="@Icons.Material.Filled.Save" 
                                                   OnClick="@SaveWebConsoleLogo"
                                                   Disabled="@string.IsNullOrEmpty(webConsoleLogoPreviewBase64)">
                                            Save & Restart
                                        </MudButton>
                                        
                                        @if (!string.IsNullOrEmpty(webConsoleLogoBase64))
                                        {
                                            <MudButton Size="Size.Small" 
                                                       Variant="Variant.Filled" 
                                                       Color="Color.Error" 
                                                       StartIcon="@Icons.Material.Filled.Delete" 
                                                       OnClick="@RemoveWebConsoleLogo">
                                                Remove Logo & Restart
                                            </MudButton>
                                        }
                                    </MudStack>
                                </MudPaper>
                            </MudTabPanel>
                            
                            <!-- Theme Palette -->
                            <MudTabPanel Text="Theme Palette" Icon="@Icons.Material.Filled.Palette">
                                <MudPaper Class="mt-0 pa-4">
                                    <MudAlert Class="mb-3" Severity="Severity.Info" Icon="@Icons.Material.Filled.Info">
                                        Customize the color palette for both light and dark modes. Use hex color codes (e.g., #FF0000 for red).<br/>
                                        <strong>Changes will apply after the web console application has been restarted.</strong>
                                    </MudAlert>
                                    
                                    <MudTabs Elevation="0" Rounded="true" Class="mt-3">
                                        
                                        <!-- Light Mode -->
                                        <MudTabPanel Text="Light Mode" Icon="@Icons.Material.Filled.LightMode">
                                            <MudStack Spacing="4" Class="mt-3">
                                                
                                                <MudText Typo="Typo.h6">Primary Colors</MudText>
                                                <MudText Typo="Typo.body2" Class="mb-2" Style="color: var(--mud-palette-text-secondary);">Main brand colors used for buttons, links, and primary UI elements. Contrast text colors ensure readability.</MudText>
                                                <MudGrid>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteLight.Primary;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteLight.Primary" Label="Primary" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteLight.Primary" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteLight.PrimaryContrastText;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteLight.PrimaryContrastText" Label="Primary Contrast Text" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteLight.PrimaryContrastText" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteLight.Secondary;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteLight.Secondary" Label="Secondary" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteLight.Secondary" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteLight.SecondaryContrastText;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteLight.SecondaryContrastText" Label="Secondary Contrast Text" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteLight.SecondaryContrastText" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteLight.Tertiary;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteLight.Tertiary" Label="Tertiary" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteLight.Tertiary" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteLight.TertiaryContrastText;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteLight.TertiaryContrastText" Label="Tertiary Contrast Text" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteLight.TertiaryContrastText" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                </MudGrid>
                                                
                                                <MudDivider />
                                                
                                                <MudText Typo="Typo.h6">Background & Surface</MudText>
                                                <MudText Typo="Typo.body2" Class="mb-2" Style="color: var(--mud-palette-text-secondary);">Background colors for the main page and surface colors for cards, dialogs, and elevated components.</MudText>
                                                <MudGrid>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteLight.Background;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteLight.Background" Label="Background" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteLight.Background" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteLight.BackgroundGray;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteLight.BackgroundGray" Label="Background Gray" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteLight.BackgroundGray" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteLight.Surface;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteLight.Surface" Label="Surface" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteLight.Surface" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                </MudGrid>
                                                
                                                <MudDivider />
                                                
                                                <MudText Typo="Typo.h6">AppBar & Drawer</MudText>
                                                <MudText Typo="Typo.body2" Class="mb-2" Style="color: var(--mud-palette-text-secondary);">Colors for the top app bar and navigation drawer (sidebar). Controls the background, text, and icon colors.</MudText>
                                                <MudGrid>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteLight.AppbarBackground;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteLight.AppbarBackground" Label="AppBar Background" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteLight.AppbarBackground" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteLight.AppbarText;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteLight.AppbarText" Label="AppBar Text" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteLight.AppbarText" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteLight.DrawerBackground;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteLight.DrawerBackground" Label="Drawer Background" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteLight.DrawerBackground" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteLight.DrawerText;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteLight.DrawerText" Label="Drawer Text" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteLight.DrawerText" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteLight.DrawerIcon;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteLight.DrawerIcon" Label="Drawer Icon" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteLight.DrawerIcon" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                </MudGrid>
                                                
                                                <MudDivider />
                                                
                                                <MudText Typo="Typo.h6">Text Colors</MudText>
                                                <MudText Typo="Typo.body2" Class="mb-2" Style="color: var(--mud-palette-text-secondary);">Text colors for different hierarchy levels. Primary for main content, secondary for less important text, disabled for inactive elements.</MudText>
                                                <MudGrid>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteLight.TextPrimary;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteLight.TextPrimary" Label="Text Primary" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteLight.TextPrimary" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteLight.TextSecondary;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteLight.TextSecondary" Label="Text Secondary" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteLight.TextSecondary" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteLight.TextDisabled;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteLight.TextDisabled" Label="Text Disabled" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteLight.TextDisabled" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                </MudGrid>
                                                
                                                <MudDivider />
                                                
                                                <MudText Typo="Typo.h6">Action Colors</MudText>
                                                <MudText Typo="Typo.body2" Class="mb-2" Style="color: var(--mud-palette-text-secondary);">Colors for interactive elements like icons and buttons in their default and disabled states.</MudText>
                                                <MudGrid>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteLight.ActionDefault;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteLight.ActionDefault" Label="Action Default" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteLight.ActionDefault" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteLight.ActionDisabled;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteLight.ActionDisabled" Label="Action Disabled" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteLight.ActionDisabled" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteLight.ActionDisabledBackground;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteLight.ActionDisabledBackground" Label="Action Disabled Background" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteLight.ActionDisabledBackground" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                </MudGrid>
                                                
                                                <MudDivider />
                                                
                                                <MudText Typo="Typo.h6">Status Colors</MudText>
                                                <MudText Typo="Typo.body2" Class="mb-2" Style="color: var(--mud-palette-text-secondary);">Semantic colors for alerts, notifications, and status indicators. Info (blue), Success (green), Warning (orange), Error (red), and Dark mode accent.</MudText>
                                                <MudGrid>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteLight.Info;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteLight.Info" Label="Info" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteLight.Info" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteLight.InfoContrastText;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteLight.InfoContrastText" Label="Info Contrast Text" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteLight.InfoContrastText" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteLight.Success;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteLight.Success" Label="Success" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteLight.Success" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteLight.SuccessContrastText;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteLight.SuccessContrastText" Label="Success Contrast Text" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteLight.SuccessContrastText" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteLight.Warning;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteLight.Warning" Label="Warning" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteLight.Warning" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteLight.WarningContrastText;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteLight.WarningContrastText" Label="Warning Contrast Text" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteLight.WarningContrastText" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteLight.Error;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteLight.Error" Label="Error" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteLight.Error" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteLight.ErrorContrastText;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteLight.ErrorContrastText" Label="Error Contrast Text" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteLight.ErrorContrastText" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteLight.Dark;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteLight.Dark" Label="Dark" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteLight.Dark" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteLight.DarkContrastText;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteLight.DarkContrastText" Label="Dark Contrast Text" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteLight.DarkContrastText" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                </MudGrid>
                                                
                                                <MudDivider />
                                                
                                                <MudText Typo="Typo.h6">Lines & Dividers</MudText>
                                                <MudText Typo="Typo.body2" Class="mb-2" Style="color: var(--mud-palette-text-secondary);">Border colors for input fields, dividers, and table elements. Controls the visual separation between UI components.</MudText>
                                                <MudGrid>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteLight.LinesDefault;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteLight.LinesDefault" Label="Lines Default" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteLight.LinesDefault" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteLight.LinesInputs;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteLight.LinesInputs" Label="Lines Inputs" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteLight.LinesInputs" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteLight.Divider;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteLight.Divider" Label="Divider" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteLight.Divider" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteLight.DividerLight;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteLight.DividerLight" Label="Divider Light" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteLight.DividerLight" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteLight.TableLines;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteLight.TableLines" Label="Table Lines" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteLight.TableLines" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteLight.TableStriped;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteLight.TableStriped" Label="Table Striped" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteLight.TableStriped" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteLight.TableHover;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteLight.TableHover" Label="Table Hover" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteLight.TableHover" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                </MudGrid>
                                                
                                                <MudDivider />
                                                
                                                <MudText Typo="Typo.h6">Gray Scale</MudText>
                                                <MudText Typo="Typo.body2" Class="mb-2" Style="color: var(--mud-palette-text-secondary);">Grayscale palette from black to white with various gray shades. Used for neutral UI elements and subtle backgrounds.</MudText>
                                                <MudGrid>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteLight.Black;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteLight.Black" Label="Black" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteLight.Black" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteLight.White;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteLight.White" Label="White" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteLight.White" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteLight.GrayDefault;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteLight.GrayDefault" Label="Gray Default" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteLight.GrayDefault" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteLight.GrayLight;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteLight.GrayLight" Label="Gray Light" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteLight.GrayLight" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteLight.GrayLighter;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteLight.GrayLighter" Label="Gray Lighter" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteLight.GrayLighter" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteLight.GrayDark;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteLight.GrayDark" Label="Gray Dark" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteLight.GrayDark" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteLight.GrayDarker;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteLight.GrayDarker" Label="Gray Darker" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteLight.GrayDarker" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                </MudGrid>
                                                
                                                <MudDivider />
                                                
                                                <MudText Typo="Typo.h6">Overlay & Hover</MudText>
                                                <MudText Typo="Typo.body2" Class="mb-2" Style="color: var(--mud-palette-text-secondary);">Overlay colors for modals and dialogs. Hover opacity controls the transparency of hover effects on interactive elements.</MudText>
                                                <MudGrid>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteLight.OverlayDark;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteLight.OverlayDark" Label="Overlay Dark" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteLight.OverlayDark" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteLight.OverlayLight;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteLight.OverlayLight" Label="Overlay Light" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteLight.OverlayLight" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudNumericField @bind-Value="themePaletteConfig.PaletteLight.HoverOpacity" Label="Hover Opacity" Variant="Variant.Outlined" Min="0" Max="1" Step="0.01" />
                                                    </MudItem>
                                                </MudGrid>
                                            </MudStack>
                                        </MudTabPanel>
                                        
                                        <!-- Dark Mode -->
                                        <MudTabPanel Text="Dark Mode" Icon="@Icons.Material.Filled.DarkMode">
                                            <MudStack Spacing="4" Class="mt-3">
                                                
                                                <MudText Typo="Typo.h6">Primary Colors</MudText>
                                                <MudText Typo="Typo.body2" Class="mb-2" Style="color: var(--mud-palette-text-secondary);">Main brand colors used for buttons, links, and primary UI elements. Contrast text colors ensure readability.</MudText>
                                                <MudGrid>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteDark.Primary;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteDark.Primary" Label="Primary" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteDark.Primary" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteDark.PrimaryContrastText;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteDark.PrimaryContrastText" Label="Primary Contrast Text" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteDark.PrimaryContrastText" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteDark.Secondary;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteDark.Secondary" Label="Secondary" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteDark.Secondary" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteDark.SecondaryContrastText;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteDark.SecondaryContrastText" Label="Secondary Contrast Text" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteDark.SecondaryContrastText" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteDark.Tertiary;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteDark.Tertiary" Label="Tertiary" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteDark.Tertiary" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteDark.TertiaryContrastText;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteDark.TertiaryContrastText" Label="Tertiary Contrast Text" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteDark.TertiaryContrastText" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                </MudGrid>
                                                
                                                <MudDivider />
                                                
                                                <MudText Typo="Typo.h6">Background & Surface</MudText>
                                                <MudText Typo="Typo.body2" Class="mb-2" Style="color: var(--mud-palette-text-secondary);">Background colors for the main page and surface colors for cards, dialogs, and elevated components.</MudText>
                                                <MudGrid>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteDark.Background;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteDark.Background" Label="Background" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteDark.Background" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteDark.BackgroundGray;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteDark.BackgroundGray" Label="Background Gray" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteDark.BackgroundGray" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteDark.Surface;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteDark.Surface" Label="Surface" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteDark.Surface" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                </MudGrid>
                                                
                                                <MudDivider />
                                                
                                                <MudText Typo="Typo.h6">AppBar & Drawer</MudText>
                                                <MudText Typo="Typo.body2" Class="mb-2" Style="color: var(--mud-palette-text-secondary);">Colors for the top app bar and navigation drawer (sidebar). Controls the background, text, and icon colors.</MudText>
                                                <MudGrid>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteDark.AppbarBackground;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteDark.AppbarBackground" Label="AppBar Background" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteDark.AppbarBackground" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteDark.AppbarText;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteDark.AppbarText" Label="AppBar Text" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteDark.AppbarText" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteDark.DrawerBackground;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteDark.DrawerBackground" Label="Drawer Background" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteDark.DrawerBackground" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteDark.DrawerText;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteDark.DrawerText" Label="Drawer Text" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteDark.DrawerText" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteDark.DrawerIcon;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteDark.DrawerIcon" Label="Drawer Icon" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteDark.DrawerIcon" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                </MudGrid>
                                                
                                                <MudDivider />
                                                
                                                <MudText Typo="Typo.h6">Text Colors</MudText>
                                                <MudText Typo="Typo.body2" Class="mb-2" Style="color: var(--mud-palette-text-secondary);">Text colors for different hierarchy levels. Primary for main content, secondary for less important text, disabled for inactive elements.</MudText>
                                                <MudGrid>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteDark.TextPrimary;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteDark.TextPrimary" Label="Text Primary" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteDark.TextPrimary" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteDark.TextSecondary;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteDark.TextSecondary" Label="Text Secondary" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteDark.TextSecondary" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteDark.TextDisabled;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteDark.TextDisabled" Label="Text Disabled" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteDark.TextDisabled" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                </MudGrid>
                                                
                                                <MudDivider />
                                                
                                                <MudText Typo="Typo.h6">Action Colors</MudText>
                                                <MudText Typo="Typo.body2" Class="mb-2" Style="color: var(--mud-palette-text-secondary);">Colors for interactive elements like icons and buttons in their default and disabled states.</MudText>
                                                <MudGrid>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteDark.ActionDefault;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteDark.ActionDefault" Label="Action Default" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteDark.ActionDefault" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteDark.ActionDisabled;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteDark.ActionDisabled" Label="Action Disabled" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteDark.ActionDisabled" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteDark.ActionDisabledBackground;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteDark.ActionDisabledBackground" Label="Action Disabled Background" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteDark.ActionDisabledBackground" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                </MudGrid>
                                                
                                                <MudDivider />
                                                
                                                <MudText Typo="Typo.h6">Status Colors</MudText>
                                                <MudText Typo="Typo.body2" Class="mb-2" Style="color: var(--mud-palette-text-secondary);">Semantic colors for alerts, notifications, and status indicators. Info (blue), Success (green), Warning (orange), Error (red), and Dark mode accent.</MudText>
                                                <MudGrid>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteDark.Info;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteDark.Info" Label="Info" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteDark.Info" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteDark.InfoContrastText;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteDark.InfoContrastText" Label="Info Contrast Text" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteDark.InfoContrastText" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteDark.Success;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteDark.Success" Label="Success" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteDark.Success" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteDark.SuccessContrastText;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteDark.SuccessContrastText" Label="Success Contrast Text" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteDark.SuccessContrastText" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteDark.Warning;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteDark.Warning" Label="Warning" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteDark.Warning" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteDark.WarningContrastText;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteDark.WarningContrastText" Label="Warning Contrast Text" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteDark.WarningContrastText" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteDark.Error;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteDark.Error" Label="Error" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteDark.Error" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteDark.ErrorContrastText;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteDark.ErrorContrastText" Label="Error Contrast Text" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteDark.ErrorContrastText" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteDark.Dark;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteDark.Dark" Label="Dark" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteDark.Dark" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteDark.DarkContrastText;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteDark.DarkContrastText" Label="Dark Contrast Text" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteDark.DarkContrastText" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                </MudGrid>
                                                
                                                <MudDivider />
                                                
                                                <MudText Typo="Typo.h6">Lines & Dividers</MudText>
                                                <MudText Typo="Typo.body2" Class="mb-2" Style="color: var(--mud-palette-text-secondary);">Border colors for input fields, dividers, and table elements. Controls the visual separation between UI components.</MudText>
                                                <MudGrid>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteDark.LinesDefault;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteDark.LinesDefault" Label="Lines Default" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteDark.LinesDefault" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteDark.LinesInputs;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteDark.LinesInputs" Label="Lines Inputs" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteDark.LinesInputs" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteDark.Divider;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteDark.Divider" Label="Divider" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteDark.Divider" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteDark.DividerLight;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteDark.DividerLight" Label="Divider Light" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteDark.DividerLight" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteDark.TableLines;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteDark.TableLines" Label="Table Lines" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteDark.TableLines" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteDark.TableStriped;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteDark.TableStriped" Label="Table Striped" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteDark.TableStriped" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteDark.TableHover;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteDark.TableHover" Label="Table Hover" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteDark.TableHover" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                </MudGrid>
                                                
                                                <MudDivider />
                                                
                                                <MudText Typo="Typo.h6">Gray Scale</MudText>
                                                <MudText Typo="Typo.body2" Class="mb-2" Style="color: var(--mud-palette-text-secondary);">Grayscale palette from black to white with various gray shades. Used for neutral UI elements and subtle backgrounds.</MudText>
                                                <MudGrid>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteDark.Black;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteDark.Black" Label="Black" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteDark.Black" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteDark.White;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteDark.White" Label="White" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteDark.White" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteDark.GrayDefault;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteDark.GrayDefault" Label="Gray Default" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteDark.GrayDefault" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteDark.GrayLight;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteDark.GrayLight" Label="Gray Light" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteDark.GrayLight" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteDark.GrayLighter;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteDark.GrayLighter" Label="Gray Lighter" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteDark.GrayLighter" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteDark.GrayDark;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteDark.GrayDark" Label="Gray Dark" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteDark.GrayDark" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteDark.GrayDarker;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteDark.GrayDarker" Label="Gray Darker" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteDark.GrayDarker" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                </MudGrid>
                                                
                                                <MudDivider />
                                                
                                                <MudText Typo="Typo.h6">Overlay & Hover</MudText>
                                                <MudText Typo="Typo.body2" Class="mb-2" Style="color: var(--mud-palette-text-secondary);">Overlay colors for modals and dialogs. Hover opacity controls the transparency of hover effects on interactive elements.</MudText>
                                                <MudGrid>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteDark.OverlayDark;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteDark.OverlayDark" Label="Overlay Dark" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteDark.OverlayDark" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudStack Spacing="2">
                                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                                <div style="width: 40px; height: 40px; border-radius: 4px; border: 1px solid #ccc; background-color: @themePaletteConfig.PaletteDark.OverlayLight;"></div>
                                                                <MudTextField @bind-Value="themePaletteConfig.PaletteDark.OverlayLight" Label="Overlay Light" Variant="Variant.Outlined" Style="flex: 1;" />
                                                            </div>
                                                            <MudColorPicker @bind-Text="themePaletteConfig.PaletteDark.OverlayLight" ColorPickerView="ColorPickerView.Spectrum" Style="width: 100%;" />
                                                        </MudStack>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="6" md="4">
                                                        <MudNumericField @bind-Value="themePaletteConfig.PaletteDark.HoverOpacity" Label="Hover Opacity" Variant="Variant.Outlined" Min="0" Max="1" Step="0.01" />
                                                    </MudItem>
                                                </MudGrid>
                                            </MudStack>
                                        </MudTabPanel>
                                        
                                    </MudTabs>
                                    
                                    @if (!string.IsNullOrEmpty(themePaletteValidationError))
                                    {
                                        <MudAlert Class="mt-3" Severity="Severity.Error" Icon="@Icons.Material.Filled.Error">
                                            @themePaletteValidationError
                                        </MudAlert>
                                    }
                                    
                                    <MudStack Row="true" Class="mt-4">
                                        <MudButton Size="Size.Small" 
                                                   Variant="Variant.Filled" 
                                                   Color="Color.Success" 
                                                   StartIcon="@Icons.Material.Filled.Save" 
                                                   OnClick="@SaveThemePalette">
                                            Save & Restart
                                        </MudButton>
                                        
                                        <MudButton Size="Size.Small" 
                                                   Variant="Variant.Filled" 
                                                   Color="Color.Warning" 
                                                   StartIcon="@Icons.Material.Filled.RestartAlt" 
                                                   OnClick="@ResetThemePaletteToDefault">
                                            Reset to Default
                                        </MudButton>
                                    </MudStack>
                                </MudPaper>
                            </MudTabPanel>
                            
                        </MudTabs>
                    </MudTabPanel>

            </MudTabs>
        }

    </Authorized>

</AuthorizeView>

@code {

    #region Permissions System

    private string permissions_json = String.Empty;

    private bool permissions_settings_enabled = false;
    private bool permissions_settings_system_enabled = false;

    private async Task<bool> Permissions()
    {
        try
        {
            bool logout = false;

            // Get the current user from the authentication state
            var user = (await AuthenticationStateProvider.GetAuthenticationStateAsync()).User;

            // Check if user is authenticated
            if (user?.Identity is not { IsAuthenticated: true })
                logout = true;

            string netlock_username = user.FindFirst(ClaimTypes.Email)?.Value;

            permissions_settings_enabled = await Classes.Authentication.Permissions.Verify_Permission(netlock_username, "settings_enabled");
                        permissions_settings_system_enabled = await Classes.Authentication.Permissions.Verify_Permission(netlock_username, "settings_system_enabled");

            if (!permissions_settings_enabled)
                logout = true;

            if (logout) // Redirect to the login page
            {
                NavigationManager.NavigateTo("/logout", true);
                return false;
            }

            // All fine? Nice.
            return true;
        }
        catch (Exception ex)
        {
            Logging.Handler.Error("/dashboard -> Permissions", "Error", ex.ToString());
            return false;
        }
    }

    #endregion

    private bool loading_overlay = false;

    private bool _isDarkMode = false;
    private bool _dnsWarning = false;
    private string _dnsWarningText = String.Empty;

    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await AfterInitializedAsync();
        }
    }

    private async Task AfterInitializedAsync()
    {
        if (!await Permissions())
            return;

        loading_overlay = true;
        StateHasChanged();

        _isDarkMode = await JSRuntime.InvokeAsync<bool>("isDarkMode");

        await MySQL_Status();
        await Fix_Settings(); // this is a hotfix code to verify if a bug is present in the database
        await Get_Servers();
        await Get_Agent_Updates();

        if (Configuration.Members_Portal.IsApiEnabled)
            await Get_Members_Portal_License_Status();

        // Get CPU Usage
        cpuUsage = await Classes.System_Information.Handler.Get_CPU_Usage();

        // Get RAM Usage
        ramUsage = await Classes.System_Information.Handler.Get_RAM_Usage();

        // Get Disk Usage
        diskUsage = await Classes.System_Information.Handler.Get_Disk_Usage();

        fileServerConnectionStatus = await Classes.Helper.Networking.Test_Connection(Configuration.File_Server.Connection_String + "/test");

        remoteServerConnectionStatus = await Classes.Helper.Networking.Test_Connection(Configuration.Remote_Server.Connection_String + "/test");

        await Check_DNS();

        await Get_Cleanup_Settings();

        await Get_Sso_Settings();
        
        await Get_Ip_Whitelist();
        
        await Get_Whitelabeling_Settings();

        loading_overlay = false;

        StateHasChanged();
    }

    private bool mysqlConnectionStatus = false;
    private bool fileServerConnectionStatus = false;
    private bool remoteServerConnectionStatus = false;

    private int cpuUsage = 0;
    private int ramUsage = 0;
    private int diskUsage = 0;

    private string mysqlVersion = String.Empty;
    private string mysqlUptime = String.Empty;
    private string mysqlConnectedUsers = String.Empty;
    private string mysqlDatabaseSize = String.Empty;
    private List<MySQL_Active_Queries> mysqlActiveQueries = new List<MySQL_Active_Queries>();
    private bool mysqlSSLEnabled = false;
    private string mysqlFailedLogins = String.Empty;
    private string mysqlPrivilegedUsers = String.Empty;
    private string mysqlMaxConnections = String.Empty;

    // Agent Update Settings
    private bool agent_updates_windows_enabled = false;
    private bool agent_updates_linux_enabled = false;
    private bool agent_updates_macos_enabled = false;
    private int agent_updates_max_concurrent_updates = 0;

    // Members Portal
    private string members_portal_api_key = String.Empty;
    private string members_portal_status = String.Empty;
    private string members_portal_license_name = String.Empty;
    private int members_portal_licenses_used = 0;
    private int members_portal_licenses_max = 0;
    private bool members_portal_licenses_hard_limit = false;
    private bool members_portal_code_signed = false;

    private string package_url = String.Empty;

    // Remote Screen Control
    private bool remoteScreenSessionRecordingForced = false;
    private bool remoteScreenSessionRecordingAutoClean = false;
    private int remoteScreenSessionRecordingForcedDays = 0;

    // SSO Configuration
    // Azure AD
    private bool azureAdEnabled = false;
    private string azureAdInstance = string.Empty;
    private string azureAdDomain = string.Empty;
    private string azureAdTenantId = string.Empty;
    private string azureAdClientId = string.Empty;
    private string azureAdClientSecret = string.Empty;
    private string azureAdCallbackPath = "/signin-oidc";
    private string azureAdSignedOutCallbackPath = "/signout-callback-oidc";
    private string azureAdResponseType = "code";
    private bool azureAdSaveTokens = false;
    
    // Keycloak
    private bool keycloakEnabled = false;
    private string keycloakAuthority = string.Empty;
    private string keycloakRealm = string.Empty;
    private string keycloakClientId = string.Empty;
    private string keycloakClientSecret = string.Empty;
    private string keycloakCallbackPath = "/signin-keycloak";
    private string keycloakSignedOutCallbackPath = "/signout-callback-keycloak";
    private string keycloakResponseType = "code";
    private bool keycloakSaveTokens = false;
    private bool keycloakGetClaimsFromUserInfoEndpoint = true;
    private bool keycloakRequireHttpsMetadata = true;
    
    // Google Identity
    private bool googleEnabled = false;
    private string googleClientId = string.Empty;
    private string googleClientSecret = string.Empty;
    private string googleCallbackPath = "/signin-google";
    private string googleSignedOutCallbackPath = "/signout-callback-google";
    private string googleHostedDomain = string.Empty;
    private bool googleSaveTokens = false;
    
    // Okta
    private bool oktaEnabled = false;
    private string oktaDomain = string.Empty;
    private string oktaClientId = string.Empty;
    private string oktaClientSecret = string.Empty;
    private string oktaCallbackPath = "/signin-okta";
    private string oktaSignedOutCallbackPath = "/signout-callback-okta";
    private string oktaAuthorizationServerId = "default";
    private bool oktaSaveTokens = false;
    private bool oktaGetClaimsFromUserInfoEndpoint = true;
    
    // Auth0
    private bool auth0Enabled = false;
    private string auth0Domain = string.Empty;
    private string auth0ClientId = string.Empty;
    private string auth0ClientSecret = string.Empty;
    private string auth0CallbackPath = "/signin-auth0";
    private string auth0SignedOutCallbackPath = "/signout-callback-auth0";
    private string auth0Audience = string.Empty;
    private bool auth0SaveTokens = false;

    // IP Whitelist
    private string ipWhitelistWebConsoleInput = string.Empty;
    private string ipWhitelistWebConsoleValidationError = string.Empty;
    private string ipWhitelistBackendInput = string.Empty;
    private string ipWhitelistBackendValidationError = string.Empty;
    
    // Whitelabeling
    private string webConsoleTitleInput = string.Empty;
    private string webConsoleTitleValidationError = string.Empty;
    
    private string webConsoleLogoBase64 = string.Empty;
    private string webConsoleLogoPreviewBase64 = string.Empty;
    private string webConsoleLogoValidationError = string.Empty;
    private string selectedLogoFileName = string.Empty;
    private IBrowserFile? selectedLogoFile = null;
    
    // Theme Palette
    private Classes.Theme.ThemePaletteConfig themePaletteConfig = new();
    private string themePaletteValidationError = string.Empty;

    public class MySQL_Active_Queries
    {
        public int Id { get; set; }
        public string User { get; set; }
        public string Host { get; set; }
        public string Database { get; set; }
        public string Command { get; set; }
        public int Time { get; set; }
        public string State { get; set; }
        public string Info { get; set; }
    }

    private bool MySQL_Active_Queries_Table_Filter_Func(MySQL_Active_Queries row)
    {
        try
        {
            if (row == null) return false; // √úberpr√ºfe, ob row null ist

            if (string.IsNullOrEmpty(mysql_active_queries_table_search_string))
                return true;

            return row.Id.ToString().Contains(mysql_active_queries_table_search_string, StringComparison.OrdinalIgnoreCase) ||
                   (row.User?.Contains(mysql_active_queries_table_search_string, StringComparison.OrdinalIgnoreCase) ?? false) ||
                   (row.Host?.Contains(mysql_active_queries_table_search_string, StringComparison.OrdinalIgnoreCase) ?? false) ||
                   (row.Database?.Contains(mysql_active_queries_table_search_string, StringComparison.OrdinalIgnoreCase) ?? false) ||
                   (row.Command?.Contains(mysql_active_queries_table_search_string, StringComparison.OrdinalIgnoreCase) ?? false) ||
                   row.Time.ToString().Contains(mysql_active_queries_table_search_string, StringComparison.OrdinalIgnoreCase) ||
                   (row.State?.Contains(mysql_active_queries_table_search_string, StringComparison.OrdinalIgnoreCase) ?? false) ||
                   (row.Info?.Contains(mysql_active_queries_table_search_string, StringComparison.OrdinalIgnoreCase) ?? false);
        }
        catch (Exception ex)
        {
            Logging.Handler.Error("/system -> MySQL_Active_Queries_Table_Filter_Func", "general_error", ex.ToString());
            return false;
        }
    }

    private string mysql_active_queries_table_sorted_column;
    private string mysql_active_queries_table_search_string = String.Empty;
    private string mysql_active_queries_selectedRowContent = ""; // Saving content of selected row

    // Executes on row click
    private void mysql_active_queries_RowClickHandler(MySQL_Active_Queries row)
    {
        mysql_active_queries_selectedRowContent = row.Id.ToString();
    }

    private string mysql_active_queries_GetRowClass(MySQL_Active_Queries row)
    {
        return row.Id.ToString() == mysql_active_queries_selectedRowContent ? "selected-row" : "";
    }

    // MySQL

    private string GetCommandColor(string command, int time)
    {
        switch (command)
        {
            case "Daemon":
                return "blue";
            case "Sleep":
                return "orange";
            case "Query":
                return time > 60 ? "red" : "green"; // Red for long queries, green for short
            default:
                return "inherit"; // Standard colour
        }
    }

    private async Task MySQL_Status()
    {
        try
        {
            if (await Classes.MySQL.Database.Check_Connection())
            {
                mysqlConnectionStatus = true;

                // Get MySQL Version
                mysqlVersion = await Classes.MySQL.Database.Get_Version();

                // Get MySQL Uptime
                mysqlUptime = await Classes.MySQL.Database.Get_Uptime();

                // Get MySQL Connected Users
                mysqlConnectedUsers = await Classes.MySQL.Database.Get_Connected_Users();

                // Get MySQL Active Queries
                string mysqlActiveQueriesJson = await Classes.MySQL.Database.Get_Active_Queries();
                Logging.Handler.Debug("/system -> MySQL_Status", "mysqlActiveQueriesJson", mysqlActiveQueriesJson);
                mysqlActiveQueries = JsonSerializer.Deserialize<List<MySQL_Active_Queries>>(mysqlActiveQueriesJson);

                // Get MySQL Failed Logins
                mysqlFailedLogins = await Classes.MySQL.Database.Get_Failed_Logins();

                // Get MySQL Max Connections
                mysqlMaxConnections = await Classes.MySQL.Database.Get_Max_Connections();

                // Get MySQL Database Size
                mysqlDatabaseSize = await Classes.MySQL.Database.Get_Database_Size();
            }
            else
            {
                mysqlConnectionStatus = false;
            }
        }
        catch (Exception ex)
        {
            Logging.Handler.Error("/system -> MySQL_Status", "general_error", ex.ToString());
        }

    }

    // Servers overview
    private List<Servers> servers = new List<Servers>();

    public class Servers
    {
        public string id { get; set; }
        public string name { get; set; }
        public string ip_address { get; set; }
        public string domain { get; set; }
        public string os { get; set; }
        public string hearthbeat { get; set; }
        public string appsettings { get; set; }
        public string cpu_usage { get; set; }
        public string ram_usage { get; set; }
        public string disk_usage { get; set; }
        public string docker { get; set; }
    }

    // Get servers from database
    private async Task Get_Servers()
    {
        servers.Clear();

        MySqlConnection conn = new MySqlConnection(Configuration.MySQL.Connection_String);

        try
        {
            await conn.OpenAsync();

            MySqlCommand command = new MySqlCommand("SELECT * FROM servers;", conn);
            using (DbDataReader reader = await command.ExecuteReaderAsync())
            {
                if (reader.HasRows)
                {
                    while (await reader.ReadAsync())
                    {
                        servers.Add(new Servers
                            {
                                id = reader["id"].ToString() ?? String.Empty,
                                name = reader["name"].ToString() ?? String.Empty,
                                ip_address = reader["ip_address"].ToString() ?? String.Empty,
                                domain = reader["domain"].ToString() ?? String.Empty,
                                os = reader["os"].ToString() ?? String.Empty,
                                hearthbeat = reader["hearthbeat"].ToString() ?? String.Empty,
                                appsettings = reader["appsettings"].ToString() ?? String.Empty,
                                cpu_usage = reader["cpu_usage"].ToString() ?? String.Empty,
                                ram_usage = reader["ram_usage"].ToString() ?? String.Empty,
                                disk_usage = reader["disk_usage"].ToString() ?? String.Empty,
                                docker = reader["docker"].ToString() ?? String.Empty
                            });
                    }
                }
            }
        }
        catch (Exception ex)
        {
            Logging.Handler.Error("/system -> Get_Servers", "general_error", ex.ToString());
        }
        finally
        {
            conn.Close();
        }
    }

    // Save api key for members portal
    //OSSCH_START 64aa9bc9-7c1c-4efb-94b9-e82dc51146f3 //OSSCH_END

    // Update members portal license information
    //OSSCH_START 3a226cc2-d41c-4390-9a48-05a61ef15096 //OSSCH_END

    // Get members portal license status
    //OSSCH_START e6474858-01f9-4d58-8f11-e56d8dd189b4 //OSSCH_END

    // Get agent updates settings
    private async Task Get_Agent_Updates()
    {
        string windows_updates_enabled = await Classes.MySQL.Handler.Quick_Reader("SELECT * FROM settings", "agent_updates_windows_enabled");
        string linux_updates_enabled = await Classes.MySQL.Handler.Quick_Reader("SELECT * FROM settings", "agent_updates_linux_enabled");
        string macos_updates_enabled = await Classes.MySQL.Handler.Quick_Reader("SELECT * FROM settings", "agent_updates_macos_enabled");

        if (windows_updates_enabled == "1")
            agent_updates_windows_enabled = true;
        else
            agent_updates_windows_enabled = false;

        if (linux_updates_enabled == "1")
            agent_updates_linux_enabled = true;
        else
            agent_updates_linux_enabled = false;

        if (macos_updates_enabled == "1")
            agent_updates_macos_enabled = true;
        else
            agent_updates_macos_enabled = false;

        agent_updates_max_concurrent_updates = Convert.ToInt32(await Classes.MySQL.Handler.Quick_Reader("SELECT * FROM settings", "agent_updates_max_concurrent_updates"));
    }

    // Set agent updates settings
    private async Task SaveAgentUpdates()
    {
        Snackbar.Configuration.ShowCloseIcon = true;
        Snackbar.Configuration.PositionClass = Defaults.Classes.Position.BottomRight;

        if (agent_updates_windows_enabled)
        {
            Logging.Handler.Debug("/system -> Set_Agent_Updates", "agent_updates_windows_enabled", "true");
            await Classes.MySQL.Handler.Execute_Command("UPDATE settings SET agent_updates_windows_enabled = 1;");
        }
        else
        {
            Logging.Handler.Debug("/system -> Set_Agent_Updates", "agent_updates_windows_enabled", "false");
            await Classes.MySQL.Handler.Execute_Command("UPDATE settings SET agent_updates_windows_enabled = 0;");
        }

        if (agent_updates_linux_enabled)
        {
            Logging.Handler.Debug("/system -> Set_Agent_Updates", "agent_updates_linux_enabled", "true");
            await Classes.MySQL.Handler.Execute_Command("UPDATE settings SET agent_updates_linux_enabled = 1;");
        }
        else
        {
            Logging.Handler.Debug("/system -> Set_Agent_Updates", "agent_updates_linux_enabled", "false");
            await Classes.MySQL.Handler.Execute_Command("UPDATE settings SET agent_updates_linux_enabled = 0;");
        }

        if (agent_updates_macos_enabled)
        {
            Logging.Handler.Debug("/system -> Set_Agent_Updates", "agent_updates_macos_enabled", "true");
            await Classes.MySQL.Handler.Execute_Command("UPDATE settings SET agent_updates_macos_enabled = 1;");
        }
        else
        {
            Logging.Handler.Debug("/system -> Set_Agent_Updates", "agent_updates_macos_enabled", "false");
            await Classes.MySQL.Handler.Execute_Command("UPDATE settings SET agent_updates_macos_enabled = 0;");
        }

        MySqlConnection conn = new MySqlConnection(Configuration.MySQL.Connection_String);

        string query = "UPDATE settings SET agent_updates_max_concurrent_updates = @agent_updates_max_concurrent_updates;";

        try
        {
            await conn.OpenAsync();

            MySqlCommand cmd = new MySqlCommand(query, conn);
            cmd.Parameters.AddWithValue("@agent_updates_max_concurrent_updates", agent_updates_max_concurrent_updates.ToString());

            Logging.Handler.Debug("SaveAgentUpdates", "MySQL_Prepared_Query", query);

            await cmd.ExecuteNonQueryAsync();
        }
        catch (Exception ex)
        {
            Logging.Handler.Error("SaveAgentUpdates", "MySQL_Query", ex.ToString());
        }
        finally
        {
            await conn.CloseAsync();
        }

        Snackbar.Add("Saved.", Severity.Success);
    }

    // Check the dns ptr record
    private async Task Check_DNS()
    {
        (_dnsWarning, _dnsWarningText) = await Classes.Setup.DNS.Check_Dns_Forward_Reverse(Configuration.Remote_Server.Hostname);
    }

    // Check connection
    private async Task Test_Remote_File_Server_Connection()
    {
        Snackbar.Configuration.ShowCloseIcon = true;
        Snackbar.Configuration.PositionClass = Defaults.Classes.Position.BottomRight;

        loading_overlay = true;
        fileServerConnectionStatus = await Classes.Helper.Networking.Test_Connection(Configuration.File_Server.Connection_String + "/test");

        remoteServerConnectionStatus = await Classes.Helper.Networking.Test_Connection(Configuration.Remote_Server.Connection_String + "/test");

        await Check_DNS();

        loading_overlay = false;

        StateHasChanged();

        if (fileServerConnectionStatus && remoteServerConnectionStatus)
        {
            Snackbar.Add(Localizer["connected"] + ".", Severity.Success);
        }
        else
        {
            Snackbar.Add(Localizer["not connected"] + ".", Severity.Error);
        }
    }

    // Automatic cleanup
    private bool cleanup_applications_drivers_history_enabled = false;
    private int cleanup_applications_drivers_history_days = 0;

    private bool cleanup_applications_installed_history_enabled = false;
    private int cleanup_applications_installed_history_days = 0;

    private bool cleanup_applications_logon_history_enabled = false;
    private int cleanup_applications_logon_history_days = 0;

    private bool cleanup_applications_scheduled_tasks_history_enabled = false;
    private int cleanup_applications_scheduled_tasks_history_days = 0;

    private bool cleanup_applications_services_history_enabled = false;
    private int cleanup_applications_services_history_days = 0;

    private bool cleanup_device_information_antivirus_products_history_enabled = false;
    private int cleanup_device_information_antivirus_products_history_days = 0;

    private bool cleanup_device_information_cpu_history_enabled = false;
    private int cleanup_device_information_cpu_history_days = 0;

    private bool cleanup_device_information_cronjobs_history_enabled = false;
    private int cleanup_device_information_cronjobs_history_days = 0;

    private bool cleanup_device_information_disks_history_enabled = false;
    private int cleanup_device_information_disks_history_days = 0;

    private bool cleanup_device_information_general_history_enabled = false;
    private int cleanup_device_information_general_history_days = 0;

    private bool cleanup_device_information_history_enabled = false;
    private int cleanup_device_information_history_days = 0;

    private bool cleanup_device_information_network_adapters_history_enabled = false;
    private int cleanup_device_information_network_adapters_history_days = 0;

    private bool cleanup_device_information_ram_history_enabled = false;
    private int cleanup_device_information_ram_history_days = 0;

    private bool cleanup_device_information_task_manager_history_enabled = false;
    private int cleanup_device_information_task_manager_history_days = 0;

    private bool cleanup_events_history_enabled = false;
    private int cleanup_events_history_days = 0;

    // Get cleanup settings from database
    private async Task Get_Cleanup_Settings()
    {
        MySqlConnection conn = new MySqlConnection(Configuration.MySQL.Connection_String);

        try
        {
            await conn.OpenAsync();

            string query = "SELECT * FROM settings;";

            MySqlCommand cmd = new MySqlCommand(query, conn);

            Logging.Handler.Debug("Example", "MySQL_Prepared_Query", query);

            using (DbDataReader reader = await cmd.ExecuteReaderAsync())
            {
                if (reader.HasRows)
                {
                    while (await reader.ReadAsync())
                    {
                        cleanup_applications_drivers_history_enabled = reader.GetBoolean(reader.GetOrdinal("cleanup_applications_drivers_history_enabled"));
                        cleanup_applications_drivers_history_days = reader.GetInt32(reader.GetOrdinal("cleanup_applications_drivers_history_days"));

                        cleanup_applications_installed_history_enabled = reader.GetBoolean(reader.GetOrdinal("cleanup_applications_installed_history_enabled"));
                        cleanup_applications_installed_history_days = reader.GetInt32(reader.GetOrdinal("cleanup_applications_installed_history_days"));

                        cleanup_applications_logon_history_enabled = reader.GetBoolean(reader.GetOrdinal("cleanup_applications_logon_history_enabled"));
                        cleanup_applications_logon_history_days = reader.GetInt32(reader.GetOrdinal("cleanup_applications_logon_history_days"));

                        cleanup_applications_scheduled_tasks_history_enabled = reader.GetBoolean(reader.GetOrdinal("cleanup_applications_scheduled_tasks_history_enabled"));
                        cleanup_applications_scheduled_tasks_history_days = reader.GetInt32(reader.GetOrdinal("cleanup_applications_scheduled_tasks_history_days"));

                        cleanup_applications_services_history_enabled = reader.GetBoolean(reader.GetOrdinal("cleanup_applications_services_history_enabled"));
                        cleanup_applications_services_history_days = reader.GetInt32(reader.GetOrdinal("cleanup_applications_services_history_days"));

                        cleanup_device_information_antivirus_products_history_enabled = reader.GetBoolean(reader.GetOrdinal("cleanup_device_information_antivirus_products_history_enabled"));
                        cleanup_device_information_antivirus_products_history_days = reader.GetInt32(reader.GetOrdinal("cleanup_device_information_antivirus_products_history_days"));

                        cleanup_device_information_cpu_history_enabled = reader.GetBoolean(reader.GetOrdinal("cleanup_device_information_cpu_history_enabled"));
                        cleanup_device_information_cpu_history_days = reader.GetInt32(reader.GetOrdinal("cleanup_device_information_cpu_history_days"));

                        cleanup_device_information_cronjobs_history_enabled = reader.GetBoolean(reader.GetOrdinal("cleanup_device_information_cronjobs_history_enabled"));
                        cleanup_device_information_cronjobs_history_days = reader.GetInt32(reader.GetOrdinal("cleanup_device_information_cronjobs_history_days"));

                        cleanup_device_information_disks_history_enabled = reader.GetBoolean(reader.GetOrdinal("cleanup_device_information_disks_history_enabled"));
                        cleanup_device_information_disks_history_days = reader.GetInt32(reader.GetOrdinal("cleanup_device_information_disks_history_days"));

                        cleanup_device_information_general_history_enabled = reader.GetBoolean(reader.GetOrdinal("cleanup_device_information_general_history_enabled"));
                        cleanup_device_information_general_history_days = reader.GetInt32(reader.GetOrdinal("cleanup_device_information_general_history_days"));

                        cleanup_device_information_history_enabled = reader.GetBoolean(reader.GetOrdinal("cleanup_device_information_history_enabled"));
                        cleanup_device_information_history_days = reader.GetInt32(reader.GetOrdinal("cleanup_device_information_history_days"));

                        cleanup_device_information_network_adapters_history_enabled = reader.GetBoolean(reader.GetOrdinal("cleanup_device_information_network_adapters_history_enabled"));
                        cleanup_device_information_network_adapters_history_days = reader.GetInt32(reader.GetOrdinal("cleanup_device_information_network_adapters_history_days"));

                        cleanup_device_information_ram_history_enabled = reader.GetBoolean(reader.GetOrdinal("cleanup_device_information_ram_history_enabled"));
                        cleanup_device_information_ram_history_days = reader.GetInt32(reader.GetOrdinal("cleanup_device_information_ram_history_days"));

                        cleanup_device_information_task_manager_history_enabled = reader.GetBoolean(reader.GetOrdinal("cleanup_device_information_task_manager_history_enabled"));
                        cleanup_device_information_task_manager_history_days = reader.GetInt32(reader.GetOrdinal("cleanup_device_information_task_manager_history_days"));

                        cleanup_events_history_enabled = reader.GetBoolean(reader.GetOrdinal("cleanup_events_history_enabled"));
                        cleanup_events_history_days = reader.GetInt32(reader.GetOrdinal("cleanup_events_history_days"));

                        remoteScreenSessionRecordingForced = reader.GetBoolean(reader.GetOrdinal("remote_screen_session_recording_forced_enabled"));
                        remoteScreenSessionRecordingAutoClean = reader.GetBoolean(reader.GetOrdinal("remote_screen_session_recording_auto_clean_enabled"));
                        remoteScreenSessionRecordingForcedDays = reader.GetInt32(reader.GetOrdinal("remote_screen_session_recording_forced_days"));
                    }
                }
            }
        }
        catch (Exception ex)
        {
            Logging.Handler.Error("Settings -> Get_Cleanup_Settings", "MySQL_Query", ex.ToString());
        }
        finally
        {
            await conn.CloseAsync();
        }
    }

    // Save cleanup settings to database (settings)
    private async Task Save_Cleanup_Settings()
    {
        Snackbar.Configuration.ShowCloseIcon = true;
        Snackbar.Configuration.PositionClass = Defaults.Classes.Position.BottomRight;

        // Save cleanup settings to database
        MySqlConnection conn = new MySqlConnection(Configuration.MySQL.Connection_String);

        string query = @"UPDATE settings SET
cleanup_applications_drivers_history_enabled = @cleanup_applications_drivers_history_enabled,
cleanup_applications_drivers_history_days = @cleanup_applications_drivers_history_days,
cleanup_applications_installed_history_enabled = @cleanup_applications_installed_history_enabled,
cleanup_applications_installed_history_days = @cleanup_applications_installed_history_days,
cleanup_applications_logon_history_enabled = @cleanup_applications_logon_history_enabled,
cleanup_applications_logon_history_days = @cleanup_applications_logon_history_days,
cleanup_applications_scheduled_tasks_history_enabled = @cleanup_applications_scheduled_tasks_history_enabled,
cleanup_applications_scheduled_tasks_history_days = @cleanup_applications_scheduled_tasks_history_days,
cleanup_applications_services_history_enabled = @cleanup_applications_services_history_enabled,
cleanup_applications_services_history_days = @cleanup_applications_services_history_days,
cleanup_device_information_antivirus_products_history_enabled = @cleanup_device_information_antivirus_products_history_enabled,
cleanup_device_information_antivirus_products_history_days = @cleanup_device_information_antivirus_products_history_days,
cleanup_device_information_cpu_history_enabled = @cleanup_device_information_cpu_history_enabled,
cleanup_device_information_cpu_history_days = @cleanup_device_information_cpu_history_days,
cleanup_device_information_cronjobs_history_enabled = @cleanup_device_information_cronjobs_history_enabled,
cleanup_device_information_cronjobs_history_days = @cleanup_device_information_cronjobs_history_days,
cleanup_device_information_disks_history_enabled = @cleanup_device_information_disks_history_enabled,
cleanup_device_information_disks_history_days = @cleanup_device_information_disks_history_days,
cleanup_device_information_general_history_enabled = @cleanup_device_information_general_history_enabled,
cleanup_device_information_general_history_days = @cleanup_device_information_general_history_days,
cleanup_device_information_history_enabled = @cleanup_device_information_history_enabled,
cleanup_device_information_history_days = @cleanup_device_information_history_days,
cleanup_device_information_network_adapters_history_enabled = @cleanup_device_information_network_adapters_history_enabled,
cleanup_device_information_network_adapters_history_days = @cleanup_device_information_network_adapters_history_days,
cleanup_device_information_ram_history_enabled = @cleanup_device_information_ram_history_enabled,
cleanup_device_information_ram_history_days = @cleanup_device_information_ram_history_days,
cleanup_device_information_task_manager_history_enabled = @cleanup_device_information_task_manager_history_enabled,
cleanup_device_information_task_manager_history_days = @cleanup_device_information_task_manager_history_days,
cleanup_events_history_enabled = @cleanup_events_history_enabled,
cleanup_events_history_days = @cleanup_events_history_days;";

        try
        {
            await conn.OpenAsync();

            MySqlCommand cmd = new MySqlCommand(query, conn);
            cmd.Parameters.AddWithValue("@cleanup_applications_drivers_history_enabled", Convert.ToInt32(cleanup_applications_drivers_history_enabled));
            cmd.Parameters.AddWithValue("@cleanup_applications_drivers_history_days", cleanup_applications_drivers_history_days);
            cmd.Parameters.AddWithValue("@cleanup_applications_installed_history_enabled", Convert.ToInt32(cleanup_applications_installed_history_enabled));
            cmd.Parameters.AddWithValue("@cleanup_applications_installed_history_days", cleanup_applications_installed_history_days);
            cmd.Parameters.AddWithValue("@cleanup_applications_logon_history_enabled", Convert.ToInt32(cleanup_applications_logon_history_enabled));
            cmd.Parameters.AddWithValue("@cleanup_applications_logon_history_days", cleanup_applications_logon_history_days);
            cmd.Parameters.AddWithValue("@cleanup_applications_scheduled_tasks_history_enabled", Convert.ToInt32(cleanup_applications_scheduled_tasks_history_enabled));
            cmd.Parameters.AddWithValue("@cleanup_applications_scheduled_tasks_history_days", cleanup_applications_scheduled_tasks_history_days);
            cmd.Parameters.AddWithValue("@cleanup_applications_services_history_enabled", Convert.ToInt32(cleanup_applications_services_history_enabled));
            cmd.Parameters.AddWithValue("@cleanup_applications_services_history_days", cleanup_applications_services_history_days);
            cmd.Parameters.AddWithValue("@cleanup_device_information_antivirus_products_history_enabled", Convert.ToInt32(cleanup_device_information_antivirus_products_history_enabled));
            cmd.Parameters.AddWithValue("@cleanup_device_information_antivirus_products_history_days", cleanup_device_information_antivirus_products_history_days);
            cmd.Parameters.AddWithValue("@cleanup_device_information_cpu_history_enabled", Convert.ToInt32(cleanup_device_information_cpu_history_enabled));
            cmd.Parameters.AddWithValue("@cleanup_device_information_cpu_history_days", cleanup_device_information_cpu_history_days);
            cmd.Parameters.AddWithValue("@cleanup_device_information_cronjobs_history_enabled", Convert.ToInt32(cleanup_device_information_cronjobs_history_enabled));
            cmd.Parameters.AddWithValue("@cleanup_device_information_cronjobs_history_days", cleanup_device_information_cronjobs_history_days);
            cmd.Parameters.AddWithValue("@cleanup_device_information_disks_history_enabled", Convert.ToInt32(cleanup_device_information_disks_history_enabled));
            cmd.Parameters.AddWithValue("@cleanup_device_information_disks_history_days", cleanup_device_information_disks_history_days);
            cmd.Parameters.AddWithValue("@cleanup_device_information_general_history_enabled", Convert.ToInt32(cleanup_device_information_general_history_enabled));
            cmd.Parameters.AddWithValue("@cleanup_device_information_general_history_days", cleanup_device_information_general_history_days);
            cmd.Parameters.AddWithValue("@cleanup_device_information_history_enabled", Convert.ToInt32(cleanup_device_information_history_enabled));
            cmd.Parameters.AddWithValue("@cleanup_device_information_history_days", cleanup_device_information_history_days);
            cmd.Parameters.AddWithValue("@cleanup_device_information_network_adapters_history_enabled", Convert.ToInt32(cleanup_device_information_network_adapters_history_enabled));
            cmd.Parameters.AddWithValue("@cleanup_device_information_network_adapters_history_days", cleanup_device_information_network_adapters_history_days);
            cmd.Parameters.AddWithValue("@cleanup_device_information_ram_history_enabled", Convert.ToInt32(cleanup_device_information_ram_history_enabled));
            cmd.Parameters.AddWithValue("@cleanup_device_information_ram_history_days", cleanup_device_information_ram_history_days);
            cmd.Parameters.AddWithValue("@cleanup_device_information_task_manager_history_enabled", Convert.ToInt32(cleanup_device_information_task_manager_history_enabled));
            cmd.Parameters.AddWithValue("@cleanup_device_information_task_manager_history_days", cleanup_device_information_task_manager_history_days);
            cmd.Parameters.AddWithValue("@cleanup_events_history_enabled", Convert.ToInt32(cleanup_events_history_enabled));
            cmd.Parameters.AddWithValue("@cleanup_events_history_days", cleanup_events_history_days);

            Logging.Handler.Debug("Settings -> Save_Cleanup_Setting", "MySQL_Prepared_Query", query);

            await cmd.ExecuteNonQueryAsync();

            Snackbar.Add("Cleanup settings saved!", Severity.Success);
        }
        catch (Exception ex)
        {
            Logging.Handler.Error("Settings -> Save_Cleanup_Settings", "MySQL_Query", ex.ToString());
        }
        finally
        {
            await conn.CloseAsync();
        }
    }

    private async Task Optimize_Database()
    {
        Snackbar.Configuration.ShowCloseIcon = true;
        Snackbar.Configuration.PositionClass = Defaults.Classes.Position.BottomRight;

        loading_overlay = true;
        StateHasChanged();

        MySqlConnection conn = new MySqlConnection(Configuration.MySQL.Connection_String);

        string query = @"OPTIMIZE TABLE `accounts`;
OPTIMIZE TABLE agent_package_configurations;
OPTIMIZE TABLE antivirus_controlled_folder_access_rulesets;
OPTIMIZE TABLE applications_drivers_history;
OPTIMIZE TABLE applications_installed_history;
OPTIMIZE TABLE applications_logon_history;
OPTIMIZE TABLE applications_scheduled_tasks_history;
OPTIMIZE TABLE applications_services_history;
OPTIMIZE TABLE automations;
OPTIMIZE TABLE device_information_antivirus_products_history;
OPTIMIZE TABLE device_information_cpu_history;
OPTIMIZE TABLE device_information_cronjobs_history;
OPTIMIZE TABLE device_information_disks_history;
OPTIMIZE TABLE device_information_general_history;
OPTIMIZE TABLE device_information_history;
OPTIMIZE TABLE device_information_network_adapters_history;
OPTIMIZE TABLE device_information_notes_history;
OPTIMIZE TABLE device_information_ram_history;
OPTIMIZE TABLE device_information_remote_shell_history;
OPTIMIZE TABLE device_information_task_manager_history;
OPTIMIZE TABLE devices;
OPTIMIZE TABLE `events`;
OPTIMIZE TABLE files;
OPTIMIZE TABLE `groups`;
OPTIMIZE TABLE infrastructure_events;
OPTIMIZE TABLE jobs;
OPTIMIZE TABLE locations;
OPTIMIZE TABLE mail_notifications;
OPTIMIZE TABLE microsoft_teams_notifications;
OPTIMIZE TABLE ntfy_sh_notifications;
OPTIMIZE TABLE performance_monitoring_ressources;
OPTIMIZE TABLE policies;
OPTIMIZE TABLE scripts;
OPTIMIZE TABLE sensors;
OPTIMIZE TABLE servers;
OPTIMIZE TABLE `settings`;
OPTIMIZE TABLE support_history;
OPTIMIZE TABLE telegram_notifications;
OPTIMIZE TABLE tenants;";

        try
        {
            await conn.OpenAsync();

            MySqlCommand cmd = new MySqlCommand(query, conn);

            Logging.Handler.Debug("Settings -> Optimize_Database", "MySQL_Prepared_Query", query);

            await cmd.ExecuteNonQueryAsync();
        }
        catch (Exception ex)
        {
            Logging.Handler.Error("Settings -> Optimize_Database", "MySQL_Query", ex.ToString());
        }
        finally
        {
            await conn.CloseAsync();
        }

        loading_overlay = false;
        StateHasChanged();

        Snackbar.Add("Database optimized!", Severity.Success);
    }

    private async Task Fix_Settings()
    {
        try
        {
            // smtp
            string smtp = String.Empty; 
            smtp = await Classes.MySQL.Handler.Quick_Reader("SELECT * FROM settings;", "smtp");

            // files api key
            string files_api_key = String.Empty;
            files_api_key = await Classes.MySQL.Handler.Quick_Reader("SELECT * FROM settings;", "files_api_key");

            if (String.IsNullOrEmpty(files_api_key))
            {
                // Generate random files api key if empty
                if (String.IsNullOrEmpty(files_api_key))
                    files_api_key = Guid.NewGuid().ToString() + "-" + Guid.NewGuid().ToString();

                // Delete old settings
                await Classes.MySQL.Handler.Execute_Command("DELETE FROM settings;");

                // Add new settings
                await Classes.MySQL.Handler.Execute_Command("INSERT INTO settings (db_version, files_api_key, smtp) VALUES ('" + Application_Settings.db_version + "', '" + files_api_key + "', '" + smtp + "');");
            }
        }
        catch (Exception ex)
        {
            Logging.Handler.Error("Settings -> Fix_Settings", "MySQL_Query", ex.ToString());
        }   
    }

    // Remote Screen Control

    private async Task SaveRemoteScreenSessionRecordingSettings()
    {
        // Check if paid user
        if (!Configuration.Members_Portal.IsCodeSigned)
        {
            // Open membership reminder dialog
            var membershipReminderDialogOptions = new DialogOptions
            {
                CloseButton = true,
                FullWidth = true,
                MaxWidth = MaxWidth.Small,
                BackgroundClass = "dialog-blurring",
            };
            
            DialogService.Show<Shared.Membership_Reminder_Dialog>(Localizer["membership required"], membershipReminderDialogOptions);
            return;
        }
        
        Snackbar.Configuration.ShowCloseIcon = true;
        Snackbar.Configuration.PositionClass = Defaults.Classes.Position.BottomRight;

        int remoteScreenSessionRecordingForcedDaysValue = remoteScreenSessionRecordingForcedDays;
        
        // Save cleanup settings to database
        MySqlConnection conn = new MySqlConnection(Configuration.MySQL.Connection_String);

        string query = @"UPDATE settings SET remote_screen_session_recording_forced_enabled = @remote_screen_session_recording_forced_enabled, remote_screen_session_recording_auto_clean_enabled = @remote_screen_session_recording_auto_clean_enabled, remote_screen_session_recording_forced_days = @remote_screen_session_recording_forced_days;";

        try
        {
            await conn.OpenAsync();

            MySqlCommand cmd = new MySqlCommand(query, conn);
            cmd.Parameters.AddWithValue("@remote_screen_session_recording_forced_enabled", Convert.ToInt32(remoteScreenSessionRecordingForced));
            cmd.Parameters.AddWithValue("@remote_screen_session_recording_auto_clean_enabled", Convert.ToInt32(remoteScreenSessionRecordingAutoClean));
            cmd.Parameters.AddWithValue("@remote_screen_session_recording_forced_days", remoteScreenSessionRecordingForcedDays);

            Logging.Handler.Debug("Settings -> SaveRemoteScreenSessionRecordingSettings", "MySQL_Prepared_Query", query);

            await cmd.ExecuteNonQueryAsync();

            Snackbar.Add("Remote screen control cleanup settings saved!", Severity.Success);
        }
        catch (Exception ex)
        {
            Logging.Handler.Error("Settings -> SaveRemoteScreenSessionRecordingSettings", "MySQL_Query", ex.ToString());
        }
        finally
        {
            await conn.CloseAsync();
        }
    }

    // SSO Settings
    //OSSCH_START 6c7b5b79-4ebe-433d-b146-8ddc64c0cf18 //OSSCH_END
    
    // IP Whitelist Settings
    private async Task Get_Ip_Whitelist()
    {
        try
        {
            // Load Web Console IP Whitelist
            string ipWhitelistWebConsoleJson = await Classes.MySQL.Handler.Quick_Reader("SELECT * FROM settings", "ip_whitelist_web_console");
            
            if (!string.IsNullOrEmpty(ipWhitelistWebConsoleJson))
            {
                var ipList = JsonSerializer.Deserialize<List<string>>(ipWhitelistWebConsoleJson);
                if (ipList != null && ipList.Count > 0)
                {
                    ipWhitelistWebConsoleInput = string.Join(", ", ipList);
                }
            }
            
            // Load Backend IP Whitelist
            string ipWhitelistBackendJson = await Classes.MySQL.Handler.Quick_Reader("SELECT * FROM settings", "ip_whitelist_backend");
            
            if (!string.IsNullOrEmpty(ipWhitelistBackendJson))
            {
                var ipList = JsonSerializer.Deserialize<List<string>>(ipWhitelistBackendJson);
                if (ipList != null && ipList.Count > 0)
                {
                    ipWhitelistBackendInput = string.Join(", ", ipList);
                }
            }
        }
        catch (Exception ex)
        {
            Logging.Handler.Error("Settings -> Get_Ip_Whitelist", "Error", ex.ToString());
        }
    }

    private bool ValidateIpAddresses(string input, out List<string> validIps, ref string validationError)
    {
        validIps = new List<string>();
        validationError = string.Empty;

        if (string.IsNullOrWhiteSpace(input))
        {
            return true; // Empty is valid (no whitelist)
        }

        var ips = input.Split(',', StringSplitOptions.RemoveEmptyEntries)
                       .Select(ip => ip.Trim())
                       .Where(ip => !string.IsNullOrWhiteSpace(ip))
                       .ToList();

        foreach (var ip in ips)
        {
            if (System.Net.IPAddress.TryParse(ip, out _))
            {
                validIps.Add(ip);
            }
            else
            {
                validationError = $"Invalid IP address: {ip}";
                return false;
            }
        }

        return true;
    }

    private async Task SaveIpWhitelistWebConsole()
    {
        // Validate IP addresses first
        if (!ValidateIpAddresses(ipWhitelistWebConsoleInput, out List<string> validIps, ref ipWhitelistWebConsoleValidationError))
        {
            Snackbar.Configuration.ShowCloseIcon = true;
            Snackbar.Configuration.PositionClass = Defaults.Classes.Position.BottomRight;
            Snackbar.Add(ipWhitelistWebConsoleValidationError, Severity.Error);
            StateHasChanged();
            return;
        }

        // Show confirmation dialog with warning about automatic restart
        var options = new DialogOptions
        {
            CloseButton = true,
            FullWidth = true,
            MaxWidth = MaxWidth.Medium,
            BackgroundClass = "dialog-blurring",
        };

        bool? dialog_result = await DialogService.ShowMessageBox(
            "Warning",
            "The web console will automatically restart after saving the IP whitelist configuration. All active user sessions will be terminated. Do you want to continue?",
            yesText: Localizer["confirm"],
            cancelText: Localizer["cancel"],
            options: options);

        bool state = Convert.ToBoolean(dialog_result == null ? "false" : "true");

        if (!state)
            return;

        try
        {
            Snackbar.Configuration.ShowCloseIcon = true;
            Snackbar.Configuration.PositionClass = Defaults.Classes.Position.BottomRight;

            loading_overlay = true;
            StateHasChanged();

            // Serialize to JSON
            string ipWhitelistJson = string.Empty;
            if (validIps.Count > 0)
            {
                ipWhitelistJson = JsonSerializer.Serialize(validIps);
            }

            // Save to database
            MySqlConnection conn = new MySqlConnection(Configuration.MySQL.Connection_String);
            string query = "UPDATE settings SET ip_whitelist_web_console = @ip_whitelist_web_console;";

            await conn.OpenAsync();
            MySqlCommand cmd = new MySqlCommand(query, conn);
            
            if (string.IsNullOrEmpty(ipWhitelistJson))
                cmd.Parameters.AddWithValue("@ip_whitelist_web_console", DBNull.Value);
            else
                cmd.Parameters.AddWithValue("@ip_whitelist_web_console", ipWhitelistJson);

            Logging.Handler.Debug("Settings -> SaveIpWhitelistWebConsole", "MySQL_Prepared_Query", query);

            await cmd.ExecuteNonQueryAsync();
            await conn.CloseAsync();

            Snackbar.Add("Web Console IP Whitelist saved successfully! Application is restarting...", Severity.Success);
            
            // Wait briefly so the user can see the success message
            await Task.Delay(2000);
            
            // Restart the application
            System.Environment.Exit(0);
        }
        catch (Exception ex)
        {
            Logging.Handler.Error("Settings -> SaveIpWhitelistWebConsole", "Error", ex.ToString());
            Snackbar.Add("Error saving Web Console IP Whitelist: " + ex.Message, Severity.Error);
            loading_overlay = false;
            StateHasChanged();
        }
    }

    private async Task SaveIpWhitelistBackend()
    {
        // Validate IP addresses first
        if (!ValidateIpAddresses(ipWhitelistBackendInput, out List<string> validIps, ref ipWhitelistBackendValidationError))
        {
            Snackbar.Configuration.ShowCloseIcon = true;
            Snackbar.Configuration.PositionClass = Defaults.Classes.Position.BottomRight;
            Snackbar.Add(ipWhitelistBackendValidationError, Severity.Error);
            StateHasChanged();
            return;
        }

        try
        {
            Snackbar.Configuration.ShowCloseIcon = true;
            Snackbar.Configuration.PositionClass = Defaults.Classes.Position.BottomRight;

            loading_overlay = true;
            StateHasChanged();

            // Serialize to JSON
            string ipWhitelistJson = string.Empty;
            if (validIps.Count > 0)
            {
                ipWhitelistJson = JsonSerializer.Serialize(validIps);
            }

            // Save to database
            MySqlConnection conn = new MySqlConnection(Configuration.MySQL.Connection_String);
            string query = "UPDATE settings SET ip_whitelist_backend = @ip_whitelist_backend;";

            await conn.OpenAsync();
            MySqlCommand cmd = new MySqlCommand(query, conn);
            
            if (string.IsNullOrEmpty(ipWhitelistJson))
                cmd.Parameters.AddWithValue("@ip_whitelist_backend", DBNull.Value);
            else
                cmd.Parameters.AddWithValue("@ip_whitelist_backend", ipWhitelistJson);

            Logging.Handler.Debug("Settings -> SaveIpWhitelistBackend", "MySQL_Prepared_Query", query);

            await cmd.ExecuteNonQueryAsync();
            await conn.CloseAsync();

            Snackbar.Add("Backend IP Whitelist saved successfully!", Severity.Success);
            
            loading_overlay = false;
            StateHasChanged();
        }
        catch (Exception ex)
        {
            Logging.Handler.Error("Settings -> SaveIpWhitelistBackend", "Error", ex.ToString());
            Snackbar.Add("Error saving Backend IP Whitelist: " + ex.Message, Severity.Error);
            loading_overlay = false;
            StateHasChanged();
        }
    }
    
    // Whitelabeling Settings
    //OSSCH_START 899c78e9-23af-416f-946c-c650dd96464c //OSSCH_END
}

